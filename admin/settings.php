<?

$rootpath = './../';
$thispath = './';
require_once $rootpath . 'global.php';


require_once INC_PATH . '/readconfig.php';
require_once INC_PATH . '/functions_mkprettytime.php';

require TSDIR . '/cache/freeleech.php';



if (($usergroups['cansettingspanel'] == '0' OR $usergroups['cansettingspanel'] != '1'))
{
    stdhead();
	error_no_permission (true);
    exit ();
}


stdhead();








function rebuild_announce_settings()
{
    global $cache, $db;

    // Загружаем ANNOUNCE из кеша
    $announce = $cache->read('ANNOUNCE');
    if (!is_array($announce)) 
	{
        return false;
    }

    // Загружаем KPS из кеша
    $kps = $cache->read('KPS');
    $bonus          = $kps['bonus'] ?? 'enable';
    $kpsseed        = $kps['kpsseed'] ?? '5.0';
    $bdayreward     = $kps['bdayreward'] ?? 'yes';
    $bdayrewardtype = $kps['bdayrewardtype'] ?? 'silverleech';

    // Загружаем данные из settings
    $settings = [];
    $query = $db->simple_select("settings", "name, value");
    while ($row = $db->fetch_array($query)) 
	{
        $settings[$row['name']] = $row['value'];
    }

    // Достаём нужные данные из settings
    $BASEURL             = $settings['BASEURL'] ?? '';
    $SITENAME            = $settings['SITENAME'] ?? '';
    $privatetrackerpatch = $settings['privatetrackerpatch'] ?? 'no';
    $gzipcompress        = $settings['gzipcompress'] ?? 'yes';
    $charset             = $settings['charset'] ?? 'UTF-8';
    $aggressivecheckip   = $settings['aggressivecheckip'] ?? 'no';
	$snatchmod = $settings['snatchmod'] ?? 'yes';

    // Собираем содержимое для файла
    $content = "<?php #DO NOT EDIT THIS FILE, PLEASE USE THE SETTINGS PANEL!!\n";
    $content .= "if(!defined('IN_ANNOUNCE')) die('Hacking attempt!');\n\n";

    // Ключи ANNOUNCE
    $announceKeys = [
        'announce_actions', 'aggressivecheat', 'nc', 'announce_wait', 'announce_interval',
        'max_rate', 'bannedclientdetect', 'allowed_clients', 'detectbrowsercheats',
        'checkconnectable', 'checkip', 'mysql_host','mysql_user', 'mysql_pass', 'mysql_db'
    ];

    foreach ($announceKeys as $key) 
	{
        $value = $announce[$key] ?? '';
        $content .= "\${$key} = '" . addslashes($value) . "';\n";
    }

    // Дополнительные данные
    $content .= "\$BASEURL = '" . addslashes($BASEURL) . "';\n";
    $content .= "\$SITENAME = '" . addslashes($SITENAME) . "';\n";
    $content .= "\$privatetrackerpatch = '" . addslashes($privatetrackerpatch) . "';\n";
    $content .= "\$gzipcompress = '" . addslashes($gzipcompress) . "';\n";
    $content .= "\$charset = '" . addslashes($charset) . "';\n";
    $content .= "\$aggressivecheckip = '" . addslashes($aggressivecheckip) . "';\n";
	$content .= "\$snatchmod = '" . addslashes($snatchmod) . "';\n";

    // Данные из KPS
    $content .= "\$bonus = '" . addslashes($bonus) . "';\n";
    $content .= "\$kpsseed = '" . addslashes($kpsseed) . "';\n";
    $content .= "\$bdayreward = '" . addslashes($bdayreward) . "';\n";
    $content .= "\$bdayrewardtype = '" . addslashes($bdayrewardtype) . "';\n";

    $content .= "?>";

    // Записываем файл
    $file = INC_PATH . '/config_announce.php';
    if (file_put_contents($file, $content) === false) 
	{
        return false;
    }

    return true;
}













function calc_cron_time ($stamp)
  {
    $ysecs = 365 * 24 * 60 * 60;
    $mosecs = 31 * 24 * 60 * 60;
    $wsecs = 7 * 24 * 60 * 60;
    $dsecs = 24 * 60 * 60;
    $hsecs = 60 * 60;
    $msecs = 60;
    $years = floor ($stamp / $ysecs);
    $stamp %= $ysecs;
    $months = floor ($stamp / $mosecs);
    $stamp %= $mosecs;
    $weeks = floor ($stamp / $wsecs);
    $stamp %= $wsecs;
    $days = floor ($stamp / $dsecs);
    $stamp %= $dsecs;
    $hours = floor ($stamp / $hsecs);
    $stamp %= $hsecs;
    $minutes = floor ($stamp / $msecs);
    $stamp %= $msecs;
    $seconds = $stamp;
    return array ('years' => $years, 'months' => $months, 'weeks' => $weeks, 'days' => $days, 'hours' => $hours, 'minutes' => $minutes);
  }



$query = $db->simple_select("settings", "name, value");
while ($row = $db->fetch_array($query)) 
{
    $settings[$row['name']] = $row['value'];
}



$announce_url = $settings['announce_urls[]'] ?? '';




// Включим буферизацию вывода
ob_start();

// ... ваш существующий код ...





if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['save_kps'])) 
{
    $kpsUpKeys = [
        'bonus','kpsseed','kpsupload','kpscomment','kpsthanks','kpsrate','kpspoll',
        'kpsmaxpoint','kpsinvite','kpstitle','kpsvip','kpsgift','kpswarning',
        'kpsratiofix','bdayreward','bdayrewardtype'
		
		
    ];

    $kpsUpData = [];

    if (isset($_POST['configoption']) && is_array($_POST['configoption'])) 
	{
        foreach ($_POST['configoption'] as $name => $value) 
		{
            if (in_array($name, $kpsUpKeys)) 
			{
                $kpsUpData[$name] = $value;
            }
        }
    }

    if (!empty($kpsUpData)) 
	{
        $cache->update('KPS', $kpsUpData);
    }

    if (!headers_sent()) 
	{
		header("Location: settings.php?saved=kps#kps-settings");
        exit();
    } 
	else 
	{
        
		echo '<script>window.location.href="settings.php?saved=kps#kps-settings";</script>';
        exit();
    }
}



if (isset($_GET['saved']) && $_GET['saved'] === 'kps')
{
    echo '<div class="alert alert-success" id="success-message">KPS settings saved successfully!</div>';
    echo '<script>
        if (window.history.replaceState) {
            let url = window.location.href.split("?")[0] + "#kps-settings";
            window.history.replaceState({}, document.title, url);
        }
        setTimeout(() => {
            const el = document.getElementById("success-message");
            if (el) el.style.display = "none";
        }, 5000);
    </script>';
}





if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['save_user_management'])) 
{
    $cleanUpKeys = [
        'ai', 'autoinvitetime', 'max_dead_torrent_time',
        'promote_gig_limit', 'promote_min_ratio', 'promote_min_reg_days',
        'demote_min_ratio', 'referrergift', 'leechwarn_min_ratio',
        'leechwarn_gig_limit', 'leechwarn_length', 'leechwarn_remove_ratio',
        'ban_user_limit'		
    ];

    $cleanUpData = [];

    if (isset($_POST['configoption']) && is_array($_POST['configoption'])) 
	{
        foreach ($_POST['configoption'] as $name => $value) 
		{
            if (in_array($name, $cleanUpKeys)) 
			{
                $cleanUpData[$name] = $value;
            }
        }
    }

    if (!empty($cleanUpData)) 
	{
        $cache->update('CLEANUP', $cleanUpData);
    }

    if (!headers_sent()) 
	{
        header("Location: settings.php?saved=cleanup#user-management-settings");
        exit();
    } 
	else 
	{
        echo '<script>window.location.href="settings.php?saved=cleanup#user-management-settings";</script>';
        exit();
    }
}


if (isset($_GET['saved']) && $_GET['saved'] === 'cleanup') 
{
    echo '<div class="alert alert-success" id="success-message">Cleanup settings saved successfully!</div>';
    echo '<script>
        if (window.history.replaceState) {
            let url = window.location.href.split("?")[0] + "#user-management-settings";
            window.history.replaceState({}, document.title, url);
        }
        setTimeout(() => {
            const el = document.getElementById("success-message");
            if (el) el.style.display = "none";
        }, 5000);
    </script>';
}










if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['save_registration'])) 
{
    $regUpKeys = [
        'invitesystem', 'regtype', 'minnamelength', 'maxnamelength', 'maxip',
        'illegalusernames', 'minpasswordlength', 'maxpasswordlength',
        'requirecomplexpasswords', 'failedlogincount', 'failedlogintext',
        'username_method', 'disableregs', 'r_verification', 'maxusers',
        'coppa', '_d_usergroup', 'invite_count', 'autogigsignup', 'autosbsignup'
    ];

    $regUpData = [];

    if (isset($_POST['configoption']) && is_array($_POST['configoption'])) 
	{
        foreach ($_POST['configoption'] as $key => $value) 
		{
            if (in_array($key, $regUpKeys)) 
			{
                $regUpData[$key] = $value;
            }
        }
    }

    if (!empty($regUpData)) 
	{
        $cache->update('SIGNUP', $regUpData);
    }

    // ✅ Редирект, как у KPS и CLEANUP
    if (!headers_sent()) 
	{
        header("Location: settings.php?saved=registration#registration-settings");
        exit();
    } 
	else 
	{
        echo '<script>window.location.href="settings.php?saved=registration#registration-settings";</script>';
        exit();
    }
}




if (isset($_GET['saved']) && $_GET['saved'] === 'registration') 
{
    echo '<div class="alert alert-success" id="success-message">Registration settings saved successfully!</div>';
    echo '<script>
        if (window.history.replaceState) {
            let url = window.location.href.split("?")[0] + "#registration-settings";
            window.history.replaceState({}, document.title, url);
        }
        setTimeout(() => {
            const el = document.getElementById("success-message");
            if (el) el.style.display = "none";
        }, 5000);
    </script>';
}







if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['save_announce'])) 
{
    $announceKeys = [
        'announce_actions', 'aggressivecheat', 'nc', 'announce_wait', 'announce_interval',
        'max_rate', 'bannedclientdetect', 'allowed_clients', 'detectbrowsercheats',
        'checkconnectable', 'checkip', 'mysql_host','mysql_user', 'mysql_pass', 'mysql_db'
    ];

    $announceData = [];
    if (isset($_POST['configoption']) && is_array($_POST['configoption'])) 
	{
        foreach ($_POST['configoption'] as $key => $value) 
		{
            if (in_array($key, $announceKeys)) 
			{
                $announceData[$key] = $value;
            }
        }
    }

    if (!empty($announceData)) 
	{
        $cache->update('ANNOUNCE', $announceData);
		rebuild_announce_settings();
    }

    // ✅ Редирект, как у KPS и CLEANUP
    if (!headers_sent()) 
	{
        header("Location: settings.php?saved=announce#announce-settings");
        exit();
    } 
	else 
	{
        echo '<script>window.location.href="settings.php?saved=announce#announce-settings";</script>';
        exit();
    }
}

if (isset($_GET['saved']) && $_GET['saved'] === 'announce') 
{
    echo '<div class="alert alert-success" id="success-message">Announce settings saved successfully!</div>';
    echo '<script>
        if (window.history.replaceState) {
            let url = window.location.href.split("?")[0] + "#announce-settings";
            window.history.replaceState({}, document.title, url);
        }
        setTimeout(() => {
            const el = document.getElementById("success-message");
            if (el) el.style.display = "none";
        }, 5000);
    </script>';
}























// Обработка сохранения STAFFTEAM

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['save_staff'])) 
{

    // 1) Собираем "белый список" валидных сотрудников.
    // ВАЖНО: используем UID (или замените на id, если у вас старая схема).
    $validStaff = [];
    $q = $db->sql_query("
        SELECT u.id, u.username
        FROM users u
        LEFT JOIN usergroups g ON (u.usergroup = g.gid)
        WHERE u.enabled = 'yes'
          AND (g.cansettingspanel = '1' OR g.issupermod = '1' OR g.canstaffpanel = '1')
    ");

    if ($db->num_rows($q) > 0) 
	{
        while ($row = $db->fetch_array($q)) 
		{
            // Ключ — uid, значение — username
            $validStaff[(string)$row['id']] = $row['username'];
        }
    }

    // 2) Безопасно читаем поля из POST
    $postIds   = isset($_POST['staffids'])   && is_array($_POST['staffids'])   ? $_POST['staffids']   : [];
    $postNames = isset($_POST['staffnames']) && is_array($_POST['staffnames']) ? $_POST['staffnames'] : [];

    $saveEntries = [];
    $errors = [];

    // 3) Проходим по строкам формы
    foreach ($postIds as $index => $staffIdRaw) {
        $staffId   = trim((string)$staffIdRaw);
        $staffName = trim((string)($postNames[$index] ?? ''));

        // Пустая строка — пропускаем
        if ($staffId === '' && $staffName === '') {
            continue;
        }

        // Базовая проверка ID на цифры
        if ($staffId !== '' && !ctype_digit($staffId)) {
            $errors[] = "{$staffName}:{$staffId} (invalid ID format)";
            continue;
        }

        // Проверяем, есть ли такой UID в белом списке
        if (!isset($validStaff[$staffId])) {
            $errors[] = "{$staffName}:{$staffId} (not allowed)";
            continue;
        }

        // Проверяем совпадение имени
        if (strcasecmp($validStaff[$staffId], $staffName) !== 0) {
            $errors[] = "{$staffName}:{$staffId} (name does not match)";
            continue;
        }

        // Всё ок — добавляем
        $saveEntries[] = "{$staffName}:{$staffId}";
    }

    // 4) Готовим URL редиректа (используем # якорь для возврата на нужную вкладку)
    $baseUrl = 'settings.php';
    $anchor  = '#staff-team';
    $params  = [];

    if (!empty($errors)) {
        // Передаём все ошибки в GET (при желании можно base64_encode)
        $params['errors'] = implode(',', $errors);
    } else {
        // Пишем файл. Если пусто — чистим файл.
        $filename = CONFIG_DIR . '/STAFFTEAM';
        $data = implode(',', $saveEntries);

        $written = @file_put_contents($filename, $data, LOCK_EX);
        if ($written === false) {
            $params['errors'] = 'WRITE_ERROR';
        } else {
            $params['saved'] = 'staff';
        }
    }

    // Собираем строку запроса
    $queryString = http_build_query($params);
    $redirectUrl = $baseUrl . ($queryString ? ('?' . $queryString) : '') . $anchor;

    // 5) Делаем редирект ИМЕННО на $redirectUrl
    if (!headers_sent()) 
	{
        header("Location: {$redirectUrl}");
        exit();
    } 
	else 
	{
        echo '<script>window.location.href=' . json_encode($redirectUrl) . ';</script>';
        exit();
    }
}













// Подключаем стили
echo '<link href="'.$BASEURL.'/include/templates/default/style/bootstrap-icons.css" rel="stylesheet">';
echo '<link href="'.$BASEURL.'/include/templates/default/style/errorss.css" rel="stylesheet">';

// Вывод сообщений на странице
if (isset($_GET['saved']) && $_GET['saved'] === 'staff') 
{
        echo ' <div class="container mt-3"> 
		<div class="card error-card"> 
		  <div class="card-header22"> 
		   <i class="bi bi-check-circle-fill text-success me-2"></i> <div> <h2 class="mb-0">Success!</h2> 
		   <p class="mb-0 opacity-75">Staff team has been successfully updated!</p> 
		   </div>
		   </div> 
		   </div> 
		   </div>';
} 
elseif (!empty($_GET['errors'])) 
{
    $errors = explode(',', $_GET['errors']);
    echo '<div class="container mt-3">
	<div class="card error-card mt-3">
            <div class="card-header22">
                <i class="bi bi-exclamation-triangle-fill text-danger me-2"></i>
                <div>
                    <h2 class="mb-0">Validation Errors</h2>
                    <p class="mb-0 opacity-75">Some entries are invalid and were not saved.</p>
                </div>
            </div>
            <div class="card-body">
                <ul class="mb-0">';
    foreach ($errors as $err) 
    {
        echo '<li>' . htmlspecialchars($err, ENT_QUOTES | ENT_SUBSTITUTE, 'UTF-8') . '</li>';
    }
    echo '</ul>
          </div>
          </div>
		  </div>';
}

// Автоскрытие success
echo '<script>
    setTimeout(() => {
        const el = document.querySelector(".error-card");
        if (el) el.style.display = "none";
    }, 5000);
</script>';







































if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['save_freeleech'])) 
{
    $_START   = $_POST['configoption']['start'];
    $_END     = $_POST['configoption']['end'];
    $_FLSTYPE = $_POST['configoption']['system'];

    $_filename = TSDIR . '/cache/freeleech.php';

    if ($fp = @fopen($_filename, 'w')) 
    {
        $_cachecontents = "<?php
/** TS Generated Cache#10 - Do Not Alter
 * Cache Name: FreeLeech
 * Generated: " . gmdate('r') . "
*/
";
        $_cachecontents .= "\$__FLSTYPE = '" . addslashes($_FLSTYPE) . "';\n";
        $_cachecontents .= "\$__F_START = '" . addslashes($_START) . "';\n";
        $_cachecontents .= "\$__F_END   = '" . addslashes($_END) . "';\n";
        $_cachecontents .= "?>";

        @fwrite($fp, $_cachecontents);
        @fclose($fp);

        // После сохранения перенаправляем на вкладку Freeleech
        //header("Location: settings.php?saved=freeleech#freeleech-settings");
        //exit;
		
		// ✅ Редирект, как у KPS и CLEANUP
    if (!headers_sent()) 
	{
        header("Location: settings.php?saved=freeleech#freeleech-settings");
        exit();
    } 
	else 
	{
        echo '<script>window.location.href="settings.php?saved=freeleech#freeleech-settings";</script>';
        exit();
    }
		
		
		
		
		
		
    } 
    else 
    {
        echo '<div class="alert alert-danger">Ошибка: невозможно записать кэш FreeLeech!</div>';
    }
}


if (isset($_GET['saved']) && $_GET['saved'] === 'freeleech') 
{
    echo '<div class="alert alert-success" id="success-message">freeleech settings saved successfully!</div>';
    echo '<script>
        if (window.history.replaceState) {
            let url = window.location.href.split("?")[0] + "#freeleech-settings";
            window.history.replaceState({}, document.title, url);
        }
        setTimeout(() => {
            const el = document.getElementById("success-message");
            if (el) el.style.display = "none";
        }, 5000);
    </script>';
}















// Обработка данных из формы
if ($_SERVER['REQUEST_METHOD'] === 'POST') 
{
    $settings_updated = false;
    
    // Инициализация и безопасное получение данных
    $configOptions = $_POST['configoption'] ?? [];
    $offlineModeType = $_POST['offline_mode_type'] ?? 'limited';
    $offlineMinutesInput = isset($_POST['offline_minutes_input']) ? (int)$_POST['offline_minutes_input'] : 30;
    
    // Обработка режима "Оффлайн"
    if (isset($configOptions['SITEONLINE']) && $configOptions['SITEONLINE'] === 'no') 
	{
        if ($offlineModeType === 'unlimited') 
		{
            // Бессрочный режим
            $configOptions['offline_minutes'] = 'unlimited';
            write_log("[MAINTENANCE] Site set to offline mode (unlimited duration)");
        } 
		else 
		{
            // Режим с ограничением по времени
            $offlineMinutesInput = max(1, min(1440, $offlineMinutesInput)); // 1-1440 минут
            $offlineEndTime = time() + ($offlineMinutesInput * 60);
            $configOptions['offline_minutes'] = $offlineEndTime;
            
            $endTimeFormatted = date('Y-m-d H:i:s', $offlineEndTime);
            write_log("[MAINTENANCE] Site set to offline for $offlineMinutesInput minutes. Will be back at: $endTimeFormatted");
            
            // Проверка на случай если время уже истекло при сохранении
            if ($offlineEndTime <= time()) 
			{
                $configOptions['SITEONLINE'] = 'yes';
                $configOptions['offline_minutes'] = '';
                write_log("[MAINTENANCE] Auto-corrected to online - specified time already passed");
            }
        }
    } 
    // Обработка режима "Онлайн"
    elseif (isset($configOptions['SITEONLINE'])) 
	{
        $configOptions['offline_minutes'] = '';
        write_log("[MAINTENANCE] Site set to online mode");
    }
    
    // Обновление настроек в БД с транзакцией
    $db->sql_query("START TRANSACTION");
    try {
        foreach ($configOptions as $name => $value) 
		{
            $escaped_value = $db->sqlesc($value);
            $escaped_name = $db->sqlesc($name);
            
            $query = "UPDATE settings SET value = $escaped_value WHERE name = $escaped_name";
            if (!$db->sql_query($query)) 
			{
                throw new Exception("Failed to update setting '$name'");
            }
        }
        
        $db->sql_query("COMMIT");
        $settings_updated = true;
        
        // Перестроение кэша настроек
        rebuild_settings();
        
        // Дополнительная проверка для ограниченного по времени режима
        if (isset($configOptions['SITEONLINE']) && $configOptions['SITEONLINE'] === 'no' 
            && $configOptions['offline_minutes'] !== 'unlimited') 
		{
            $remainingMinutes = ceil(($configOptions['offline_minutes'] - time()) / 60);
            write_log("[MAINTENANCE] Time remaining: " . max(0, $remainingMinutes) . " minutes");
        }
        
    } catch (Exception $e) {
        $db->sql_query("ROLLBACK");
        write_log("[ERROR] Settings update failed: " . $e->getMessage());
        echo '<div class="alert alert-danger">Error: ' . htmlspecialchars($e->getMessage()) . '</div>';
    }
    
    // Редирект после успешного сохранения
    if ($settings_updated) 
	{
        $redirectUrl = $_SERVER['PHP_SELF'] . '?saved=1';
        if (!headers_sent()) 
		{
            header("Location: $redirectUrl");
            exit();
        }
        echo '<script>window.location.href="' . htmlspecialchars($redirectUrl) . '";</script>';
        exit();
    }
}






// Показываем сообщение об успешном сохранении
if (isset($_GET['saved']) && $_GET['saved'] == 1) 
{
    echo '<div class="container mt-3"><div class="alert alert-success" id="success-message">Settings updated successfully!</div></div>';
    echo '<script>
        // Удаляем параметр saved из URL без перезагрузки страницы
        if (window.history.replaceState) {
            var cleanUrl = window.location.href.split("?")[0];
            window.history.replaceState({}, document.title, cleanUrl);
        }
        
        // Автоматически скрываем сообщение через 5 секунд
        setTimeout(function() {
            var element = document.getElementById("success-message");
            if (element) {
                element.style.display = "none";
            }
        }, 5000);
    </script>';
}

// Завершаем буферизацию
ob_end_flush();








?>

    <title>Ruff Tracker Admin Panel</title>

   
   
   
   
   
   
   
   
   
   
   
   
	<div class="container mt-3">
        <div class="row">
            

<!-- Sidebar -->

<div class="row g-0">
    <div class="col-md-3 col-lg-2 sidebar">
        
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link active" href="#main-settings" data-bs-toggle="tab">
                    <i class="fas fa-cog me-2"></i>Main Settings
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#tracker-settings" data-bs-toggle="tab">
                    <i class="fas fa-server me-2"></i>Tracker Settings
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#date-time" data-bs-toggle="tab">
                    <i class="far fa-clock me-2"></i>Date & Time
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#cookie-settings" data-bs-toggle="tab">
                    <i class="fas fa-cookie me-2"></i>Cookie Settings
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#avatar-settings" data-bs-toggle="tab">
                    <i class="fas fa-user-circle me-2"></i>Avatar Settings
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#security-settings" data-bs-toggle="tab">
                    <i class="fas fa-shield-alt me-2"></i>Security Settings
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#email-settings" data-bs-toggle="tab">
                    <i class="fas fa-envelope me-2"></i>Email Settings
                </a>
            </li>
			
			
			<li class="nav-item">
                <a class="nav-link" href="#announce-settings" data-bs-toggle="tab">
                    <i class="fas fa-broadcast-tower me-2"></i>ANNOUNCE Settings
                </a>
            </li>
			
			
			<li class="nav-item">
                <a class="nav-link" href="#kps-settings" data-bs-toggle="tab">
                    <i class="fas fa-coins me-2"></i>KPS Settings
               </a>
            </li>
			
			
			<li class="nav-item">
                <a class="nav-link" href="#user-management-settings" data-bs-toggle="tab">
                    <i class="fas fa-users-cog me-2"></i>Cleanup Settings
                </a>
            </li>
			
			
			
			
			<li class="nav-item">
    <a class="nav-link" href="#registration-settings" data-bs-toggle="tab">
        <span class="nav-icon-wrapper">
            <i class="fas fa-user-plus me-2"></i>
            <span class="nav-link-text">Registration</span>
        </span>
    </a>
</li>



<li class="nav-item">
    <a class="nav-link" href="#staff-team" data-bs-toggle="tab">
        <i class="fas fa-users-cog me-2"></i>Staff Team
    </a>
</li>


<li class="nav-item">
    <a class="nav-link" href="#freeleech-settings" data-bs-toggle="tab">
        <i class="fas fa-gift me-2"></i> Freeleech Settings
    </a>
</li>





			
			
			<li class="nav-item">
    <a class="nav-link" href="#cron-settings" data-bs-toggle="tab">
        <i class="fas fa-clock me-2"></i>Cronjobs
    </a>
</li>


			
			
			
			
        </ul>
    </div>








			
			

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Tracker Settings</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <button class="btn btn-primary" type="submit" form="settings-form">
                            <i class="fas fa-save me-1"></i> Save Settings
                        </button>
                    </div>
                </div>

                <div class="tab-content">
                    <!-- Main Settings Tab -->
                    <div class="tab-pane fade show active" id="main-settings">
                        <form id="settings-form" method="post">
                            <div class="card mb-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Basic Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="sitename" class="form-label">Tracker Name</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="sitename" name="configoption[SITENAME]" value="<?php echo htmlspecialchars($settings['SITENAME']); ?>">
                                            <span class="input-group-text help-icon" title="Enter your Tracker name here.">
                                                <i class="fas fa-info-circle"></i>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="baseurl" class="form-label">Base URL</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="baseurl" name="configoption[BASEURL]" value="<?php echo htmlspecialchars($settings['BASEURL']); ?>">
                                            <span class="input-group-text help-icon" title="Enter your tracker URL here. ie: http://yourwebsiteurl.com. Note: NO trailing slash (/) at the end!">
                                                <i class="fas fa-info-circle"></i>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="siteemail" class="form-label">Site Email</label>
                                        <div class="input-group">
                                            <input type="email" class="form-control" id="siteemail" name="configoption[SITEEMAIL]" value="<?php echo htmlspecialchars($settings['SITEEMAIL']); ?>">
                                            <span class="input-group-text help-icon" title="Enter your tracker contact email here. ie: contact@sitename.com">
                                                <i class="fas fa-info-circle"></i>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="reportemail" class="form-label">Report Email</label>
                                        <div class="input-group">
                                            <input type="email" class="form-control" id="reportemail" name="configoption[REPORTMAIL]" value="<?php echo htmlspecialchars($settings['REPORTMAIL']); ?>">
                                            <span class="input-group-text help-icon" title="Enter your tracker report email here. ie: report@sitename.com">
                                                <i class="fas fa-info-circle"></i>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="contactemail" class="form-label">Contact Email(s)</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="contactemail" name="configoption[contactemail]" value="<?php echo htmlspecialchars($settings['contactemail']); ?>">
                                            <span class="input-group-text help-icon" title="Enter your tracker contact E-mail addresses here. They will be used on Contact Us Page. Separate multiple E-mails with commas.">
                                                <i class="fas fa-info-circle"></i>
                                            </span>
                                        </div>
                                    </div>

                                    
									
									
									
									







<?php
// Получаем текущее значение из настроек
$offlineMinutesValue = isset($settings['offline_minutes']) ? $settings['offline_minutes'] : '';

// Определяем значение для поля ввода и информацию о времени
$durationMinutes = 30; // Значение по умолчанию
$timeRemaining = '';
$isUnlimited = false;

if ($settings['SITEONLINE'] === 'no') {
    if ($offlineMinutesValue === 'unlimited') {
        $isUnlimited = true;
        $durationMinutes = 'unlimited';
        $timeRemaining = '<span class="text-success">Unlimited (manual enable required)</span>';
    } elseif (is_numeric($offlineMinutesValue) && $offlineMinutesValue > time()) {
        // Расчет оставшегося времени
        $remainingSeconds = $offlineMinutesValue - time();
        $remainingMinutes = ceil($remainingSeconds / 60);
        $durationMinutes = max(1, $remainingMinutes);
        
        // Форматирование времени
        $hours = floor($remainingMinutes / 60);
        $minutes = $remainingMinutes % 60;
        
        $timeParts = [];
        if ($hours > 0) {
            $timeParts[] = $hours . ' ' . ($hours === 1 ? 'hour' : 'hours');
        }
        if ($minutes > 0 || $hours === 0) {
            $timeParts[] = $minutes . ' ' . ($minutes === 1 ? 'minute' : 'minutes');
        }
        
        $timeRemaining = implode(' and ', $timeParts) . ' remaining';
        $timeRemaining = '<span class="text-warning">' . $timeRemaining . '</span>';
    } else {
        $durationMinutes = is_numeric($offlineMinutesValue) ? max(1, (int)$offlineMinutesValue) : 30;
        $timeRemaining = '<span class="text-danger">Time expired (should auto-enable)</span>';
    }
}
?>

<!-- Форма в админке -->
<div class="mb-3">
    <label for="siteonline" class="form-label">Site Status</label>
    <select class="form-select" id="siteonline" name="configoption[SITEONLINE]">
        <option value="yes" <?= $settings['SITEONLINE'] === 'yes' ? 'selected' : '' ?>>Online</option>
        <option value="no" <?= $settings['SITEONLINE'] === 'no' ? 'selected' : '' ?>>Offline</option>
    </select>
</div>

<div class="mb-3" id="offlineDurationGroup" style="display: <?= $settings['SITEONLINE'] === 'no' ? 'block' : 'none' ?>;">
    <?php if ($timeRemaining): ?>
    <div class="alert alert-info mb-3">
        <i class="bi bi-clock"></i> <?= $timeRemaining ?>
        <?php if (!$isUnlimited && is_numeric($offlineMinutesValue)): ?>
        <div class="small mt-1">Will be back at: <?= date('Y-m-d H:i:s', $offlineMinutesValue) ?></div>
        <?php endif; ?>
    </div>
    <?php endif; ?>

    <div class="form-check mb-2">
        <input class="form-check-input" type="radio" name="offline_mode_type" id="limitedMode" 
               value="limited" <?= !$isUnlimited ? 'checked' : '' ?>>
        <label class="form-check-label" for="limitedMode">
            Limited Time
        </label>
    </div>
    
    <div class="form-check mb-3">
        <input class="form-check-input" type="radio" name="offline_mode_type" id="unlimitedMode" 
               value="unlimited" <?= $isUnlimited ? 'checked' : '' ?>>
        <label class="form-check-label" for="unlimitedMode">
            Unlimited
        </label>
    </div>
    
    <div id="timeLimitGroup" style="display: <?= !$isUnlimited ? 'block' : 'none' ?>;">
        <label for="offline_minutes_input" class="form-label">Duration (minutes)</label>
        <div class="input-group">
            <input type="number" min="1" max="1440" class="form-control" 
                   id="offline_minutes_input" name="offline_minutes_input" 
                   value="<?= !$isUnlimited ? $durationMinutes : 30 ?>">
            <span class="input-group-text">min (max 24h)</span>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const siteOnline = document.getElementById("siteonline");
    const durationGroup = document.getElementById("offlineDurationGroup");
    const limitedMode = document.getElementById("limitedMode");
    const unlimitedMode = document.getElementById("unlimitedMode");
    const timeLimitGroup = document.getElementById("timeLimitGroup");
    
    siteOnline.addEventListener("change", function() {
        durationGroup.style.display = this.value === 'no' ? 'block' : 'none';
    });
    
    limitedMode.addEventListener("change", function() {
        timeLimitGroup.style.display = this.checked ? 'block' : 'none';
    });
    
    unlimitedMode.addEventListener("change", function() {
        timeLimitGroup.style.display = this.checked ? 'none' : 'block';
    });
});
</script>










									
									
									
									
									
									
									

                                    <div class="mb-3">
                                        <label for="slogan" class="form-label">Tracker Slogan</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="slogan" name="configoption[slogan]" value="<?php echo htmlspecialchars($settings['slogan']); ?>">
                                            <span class="input-group-text help-icon" title="Set your tracker slogan.">
                                                <i class="fas fa-info-circle"></i>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="metakeywords" class="form-label">Meta Keywords</label>
                                        <div class="input-group">
                                            <textarea class="form-control" id="metakeywords" name="configoption[metakeywords]" rows="3"><?php echo htmlspecialchars($settings['metakeywords']); ?></textarea>
                                            <span class="input-group-text help-icon" title="Type in keywords separated by commas that describe your website. These keywords will help your site be listed in search engines.">
                                                <i class="fas fa-info-circle"></i>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="metadesc" class="form-label">Meta Description</label>
                                        <div class="input-group">
                                            <textarea class="form-control" id="metadesc" name="configoption[metadesc]" rows="3"><?php echo htmlspecialchars($settings['metadesc']); ?></textarea>
                                            <span class="input-group-text help-icon" title="Description of your website: Helps your website's position in search engines.">
                                                <i class="fas fa-info-circle"></i>
                                            </span>
                                        </div>
                                    </div>
									
											
									
									
								
									
                                </div>
                            </div>
						</div>	
							
							
							
							<!-- Tracker Settings Tab -->
                    <div class="tab-pane fade" id="tracker-settings">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5>Tracker Configuration</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="useajax" class="form-label">Active Ajax Features?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="useajax" name="configoption[useajax]">
                                            <option value="yes" <?php echo ($settings['useajax'] == 'yes') ? 'selected' : ''; ?>>Active</option>
                                            <option value="no" <?php echo ($settings['useajax'] == 'no') ? 'selected' : ''; ?>>Disable</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="AJAX uses javascript and features of recent browsers to allow additional data to be retrieved without doing a page refresh.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
								
								
								
								
								
								<div class="mb-3">
    <label for="use_xmlhttprequest" class="form-label">Use Xmlhttprequest</label>
    <div class="input-group">
        <select class="form-select" id="use_xmlhttprequest" name="configoption[use_xmlhttprequest]">
            <option value="1" <?= ($settings['use_xmlhttprequest'] == '1') ? 'selected' : '' ?>>Yes</option>
            <option value="0" <?= ($settings['use_xmlhttprequest'] == '0') ? 'selected' : '' ?>>No</option>
        </select>
        <span class="input-group-text help-icon" 
              title="Do you want to show a 'jump to page' form in pagination if number of pages exceeds 'Maximum Page Links in Pagination'?">
            <i class="fas fa-fast-forward"></i>
        </span>
    </div>
</div>	









<div class="mb-3">
    <label for="redirects" class="form-label">Friendly Redirection Pages</label>
    <div class="input-group">
        <select class="form-select" id="redirects" name="configoption[redirects]">
            <option value="1" <?= ($settings['redirects'] == '1') ? 'selected' : '' ?>>Yes</option>
            <option value="0" <?= ($settings['redirects'] == '0') ? 'selected' : '' ?>>No</option>
        </select>
        <span class="input-group-text help-icon" 
              title="This will enable friendly redirection pages instead of bumping the user directly to the page">
            <i class="fas fa-fast-forward"></i>
        </span>
    </div>
</div>	










								
								
								
								
								
								
								
								
								

                                <div class="mb-3">
                                    <label for="externalscrape" class="form-label">Active External Scrape?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="externalscrape" name="configoption[externalscrape]">
                                            <option value="yes" <?php echo ($settings['externalscrape'] == 'yes') ? 'selected' : ''; ?>>Active</option>
                                            <option value="no" <?php echo ($settings['externalscrape'] == 'no') ? 'selected' : ''; ?>>Disable</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Users can also upload torrents tracked by other public trackers!">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="includeexpeers" class="form-label">Include External Peers?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="includeexpeers" name="configoption[includeexpeers]">
                                            <option value="yes" <?php echo ($settings['includeexpeers'] == 'yes') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="no" <?php echo ($settings['includeexpeers'] == 'no') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Include External Peers to Internal Peers which will update stats automatically.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="membersonly" class="form-label">Registered Members Only?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="membersonly" name="configoption[MEMBERSONLY]">
                                            <option value="yes" <?php echo ($settings['MEMBERSONLY'] == 'yes') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="no" <?php echo ($settings['MEMBERSONLY'] == 'no') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="If you set this to 'NO', guests can access to some pages such as index, browse, forums etc.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="maxloginattempts" class="form-label">Max. Login Attempts</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="maxloginattempts" name="configoption[maxloginattempts]" value="<?php echo htmlspecialchars($settings['maxloginattempts']); ?>">
                                        <span class="input-group-text help-icon" title="Disable/Ban IP address who exceed this limit.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="securehash" class="form-label">Secure Hash</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="securehash" name="configoption[securehash]" value="<?php echo htmlspecialchars($settings['securehash']); ?>">
                                        <span class="input-group-text help-icon" title="Please enter a secure word that only known by you. Whenever you change this, all users must re-login.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="announce_urls" class="form-label">Announce URL</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="announce_urls" name="configoption[announce_urls[]]" value="<?php echo htmlspecialchars($announce_url); ?>">

                                        <span class="input-group-text help-icon" title="Enter your announce URL here. ie: http://yourwebsiteurl.com/announce.php">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="torrent_dir" class="form-label">Torrent Directory Path</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="torrent_dir" name="configoption[torrent_dir]" value="<?php echo htmlspecialchars($settings['torrent_dir']); ?>">
                                        <span class="input-group-text help-icon" title="Enter Tracker Torrent Directory Path. Note: NO trailing slash (/) at the end!">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
								
								
								
								<!-- Max. Torrent Size -->
                                    <div class="mb-3">
                                        <label for="max_torrent_size" class="form-label">Max. Torrent Size?</label>
                                        <div class="input-group">
                                             <input type="text" class="form-control" id="max_torrent_size" name="configoption[max_torrent_size]" value="<?php echo htmlspecialchars($settings['max_torrent_size']); ?>" class="bginput">
                                             <span class="input-group-text help-icon" title="Max. Torrent Limit for Upload. 10 GB (10 * 1024 * 1024)">
                                                 <i class="fas fa-info-circle"></i>
                                             </span>
                                        </div>
                                    </div>
								
								
								
								
								
								
								

                                <div class="mb-3">
                                    <label for="pic_base_url" class="form-label">Image Directory Path</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="pic_base_url" name="configoption[pic_base_url]" value="<?php echo htmlspecialchars($settings['pic_base_url']); ?>">
                                        <span class="input-group-text help-icon" title="Enter Tracker Image Directory Path. Note: ADD a trailing slash (/) at the end!">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
                                
								
								<div class="mb-3">
                                    <label for="seourls" class="form-label">Active SEO</label>
                                    <div class="input-group">
                                        <select class="form-select" id="seourls" name="configoption[seourls]">
                                           <option value="yes" <?php echo ($settings['seourls'] == 'yes') ? 'selected' : ''; ?>>Active</option>
                                           <option value="no" <?php echo ($settings['seourls'] == 'no') ? 'selected' : ''; ?>>Disable</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Check banned IP's in Aggressive mode. This might decrease server load.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
								
								
								
								<div class="mb-3">
    <label for="gzipcompress" class="form-label">GZIP Compression Enabled</label>
    <div class="input-group">
        <select class="form-select" id="gzipcompress" name="configoption[gzipcompress]">
            <option value="yes" <?php echo ($settings['gzipcompress'] == 'yes' ? 'selected' : ''); ?>>Yes</option>
            <option value="no" <?php echo ($settings['gzipcompress'] == 'no' ? 'selected' : ''); ?>>No</option>
        </select>
        <span class="input-group-text help-icon" title="If your server is running off of apache, then you can turn this setting on to compress your pages potentially making your site much quicker.">
            <i class="fas fa-compress-alt"></i>
        </span>
    </div>
</div>
			

		<div class="mb-3">
    <label for="jumptopagemultipage" class="form-label">Show Jump To Page Form in Pagination</label>
    <div class="input-group">
        <select class="form-select" id="jumptopagemultipage" name="configoption[jumptopagemultipage]">
            <option value="1" <?= ($settings['jumptopagemultipage'] == '1') ? 'selected' : '' ?>>Yes</option>
            <option value="0" <?= ($settings['jumptopagemultipage'] == '0') ? 'selected' : '' ?>>No</option>
        </select>
        <span class="input-group-text help-icon" 
              title="Do you want to show a 'jump to page' form in pagination if number of pages exceeds 'Maximum Page Links in Pagination'?">
            <i class="fas fa-fast-forward"></i>
        </span>
    </div>
</div>	




                         <div class="mb-3">
                                    <label for="maxmultipagelinks" class="form-label">Maximum Page Links in Pagination</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="maxmultipagelinks" name="configoption[maxmultipagelinks]" value="<?php echo htmlspecialchars($settings['maxmultipagelinks']); ?>">
                                        <span class="input-group-text help-icon" title="Here you can set the number of next and previous page links to show in the pagination for threads or forums with more than one page of results. Set to 0 to disable the limitation">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
								
								
								
								
							<div class="mb-3">
    <label for="hitrun" class="form-label">HIT & RUN System Enabled?</label>
    <div class="input-group">
        <select class="form-select" id="hitrun" name="configoption[hitrun]">
            <option value="yes" <?= $settings['hitrun'] == 'yes' ? 'selected' : '' ?>>Yes</option>
            <option value="no" <?= $settings['hitrun'] == 'no' ? 'selected' : '' ?>>No</option>
        </select>
        <span class="input-group-text help-icon" title="Enable or disable HIT & RUN system.">
            <i class="fas fa-info-circle"></i>
        </span>
    </div>
</div>

<div class="mb-3">
    <label for="hitrun_ratio" class="form-label">Min. Ratio for HIT & RUN</label>
    <div class="input-group">
        <input type="text" class="form-control" id="hitrun_ratio" 
               name="configoption[hitrun_ratio]" value="<?= htmlspecialchars($settings['hitrun_ratio']) ?>">
        <span class="input-group-text help-icon" title="Minimum ratio allowed before marking as HIT & RUN.">
            <i class="fas fa-info-circle"></i>
        </span>
    </div>
</div>

<div class="mb-3">
    <label for="hitrun_gig" class="form-label">Min. GB limit for HIT & RUN</label>
    <div class="input-group">
        <input type="text" class="form-control" id="hitrun_gig" 
               name="configoption[hitrun_gig]" value="<?= htmlspecialchars($settings['hitrun_gig']) ?>">
        <span class="input-group-text help-icon" title="Minimum GB downloaded before HIT & RUN triggers.">
            <i class="fas fa-info-circle"></i>
        </span>
    </div>
</div>
	
								
								
								
								
								
								
								
								
								
								
								








<div class="mb-3">
    <label for="wolcutoffmins" class="form-label">Cut-off Time (mins)</label>
    <div class="input-group" style="max-width: 200px;">
        <input type="number" class="form-control" id="wolcutoffmins" 
               name="configoption[wolcutoffmins]" value="<?= htmlspecialchars($settings['wolcutoffmins']) ?>"
               min="1" max="60" step="1">
        <span class="input-group-text help-icon" 
              title="The number of minutes before a user is marked offline. Recommended: 15">
            <i class="fas fa-clock"></i>
        </span>
    </div>
</div>
							
							
							
							
							
							
							</div>
                        </div>
                    </div>
				






























				
							
							
				<!-- Date & Time Settings Tab -->
                    <div class="tab-pane fade" id="date-time">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5>Date & Time Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="dateformat" class="form-label">Date Format</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="dateformat" name="configoption[dateformat]" value="<?php echo htmlspecialchars($settings['dateformat']); ?>">
                                        <span class="input-group-text help-icon" title="The format of the dates used on the tracker/forum. This format uses the PHP date() function.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="timeformat" class="form-label">Time Format</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="timeformat" name="configoption[timeformat]" value="<?php echo htmlspecialchars($settings['timeformat']); ?>">
                                        <span class="input-group-text help-icon" title="The format of the dates used on the tracker/forum. This format uses the PHP date() function.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="regdateformat" class="form-label">Registered Date Format</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="regdateformat" name="configoption[regdateformat]" value="<?php echo htmlspecialchars($settings['regdateformat']); ?>">
                                        <span class="input-group-text help-icon" title="The format used on showthread/userdetails etc.. where it shows when the user registered.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="timezoneoffset" class="form-label">Default Timezone Offset</label>
                                    <div class="input-group">
                                        <select class="form-select" id="timezoneoffset" name="configoption[timezoneoffset]">
                                            <option value="-12" <?php echo ($settings['timezoneoffset'] == '-12') ? 'selected' : ''; ?>>GMT -12:00 hours</option>
                                            <option value="-11" <?php echo ($settings['timezoneoffset'] == '-11') ? 'selected' : ''; ?>>GMT -11:00 hours</option>
                                            <option value="-10" <?php echo ($settings['timezoneoffset'] == '-10') ? 'selected' : ''; ?>>GMT -10:00 hours</option>
                                            <option value="-9" <?php echo ($settings['timezoneoffset'] == '-9') ? 'selected' : ''; ?>>GMT -9:00 hours</option>
                                            <option value="-8" <?php echo ($settings['timezoneoffset'] == '-8') ? 'selected' : ''; ?>>GMT -8:00 hours</option>
                                            <option value="-7" <?php echo ($settings['timezoneoffset'] == '-7') ? 'selected' : ''; ?>>GMT -7:00 hours</option>
                                            <option value="-6" <?php echo ($settings['timezoneoffset'] == '-6') ? 'selected' : ''; ?>>GMT -6:00 hours</option>
                                            <option value="-5" <?php echo ($settings['timezoneoffset'] == '-5') ? 'selected' : ''; ?>>GMT -5:00 hours</option>
                                            <option value="-4" <?php echo ($settings['timezoneoffset'] == '-4') ? 'selected' : ''; ?>>GMT -4:00 hours</option>
                                            <option value="-3.5" <?php echo ($settings['timezoneoffset'] == '-3.5') ? 'selected' : ''; ?>>GMT -3:30 hours</option>
                                            <option value="-3" <?php echo ($settings['timezoneoffset'] == '-3') ? 'selected' : ''; ?>>GMT -3:00 hours</option>
                                            <option value="-2" <?php echo ($settings['timezoneoffset'] == '-2') ? 'selected' : ''; ?>>GMT -2:00 hours</option>
                                            <option value="-1" <?php echo ($settings['timezoneoffset'] == '-1') ? 'selected' : ''; ?>>GMT -1:00 hours</option>
                                            <option value="0" <?php echo ($settings['timezoneoffset'] == '0') ? 'selected' : ''; ?>>GMT</option>
                                            <option value="+1" <?php echo ($settings['timezoneoffset'] == '+1') ? 'selected' : ''; ?>>GMT +1:00 hours</option>
                                            <option value="+2" <?php echo ($settings['timezoneoffset'] == '+2') ? 'selected' : ''; ?>>GMT +2:00 hours</option>
                                            <option value="+3" <?php echo ($settings['timezoneoffset'] == '+3') ? 'selected' : ''; ?>>GMT +3:00 hours</option>
                                            <option value="+3.5" <?php echo ($settings['timezoneoffset'] == '+3.5') ? 'selected' : ''; ?>>GMT +3:30 hours</option>
                                            <option value="+4" <?php echo ($settings['timezoneoffset'] == '+4') ? 'selected' : ''; ?>>GMT +4:00 hours</option>
                                            <option value="+4.5" <?php echo ($settings['timezoneoffset'] == '+4.5') ? 'selected' : ''; ?>>GMT +4:30 hours</option>
                                            <option value="+5" <?php echo ($settings['timezoneoffset'] == '+5') ? 'selected' : ''; ?>>GMT +5:00 hours</option>
                                            <option value="+5.5" <?php echo ($settings['timezoneoffset'] == '+5.5') ? 'selected' : ''; ?>>GMT +5:30 hours</option>
                                            <option value="+5.75" <?php echo ($settings['timezoneoffset'] == '+5.75') ? 'selected' : ''; ?>>GMT +5:45 hours</option>
                                            <option value="+6" <?php echo ($settings['timezoneoffset'] == '+6') ? 'selected' : ''; ?>>GMT +6:00 hours</option>
                                            <option value="+7" <?php echo ($settings['timezoneoffset'] == '+7') ? 'selected' : ''; ?>>GMT +7:00 hours</option>
                                            <option value="+8" <?php echo ($settings['timezoneoffset'] == '+8') ? 'selected' : ''; ?>>GMT +8:00 hours</option>
                                            <option value="+9" <?php echo ($settings['timezoneoffset'] == '+9') ? 'selected' : ''; ?>>GMT +9:00 hours</option>
                                            <option value="+9.5" <?php echo ($settings['timezoneoffset'] == '+9.5') ? 'selected' : ''; ?>>GMT +9:30 hours</option>
                                            <option value="+10" <?php echo ($settings['timezoneoffset'] == '+10') ? 'selected' : ''; ?>>GMT +10:00 hours</option>
                                            <option value="+10.5" <?php echo ($settings['timezoneoffset'] == '+10.5') ? 'selected' : ''; ?>>GMT +10:30 hours</option>
                                            <option value="+11" <?php echo ($settings['timezoneoffset'] == '+11') ? 'selected' : ''; ?>>GMT +11:00 hours</option>
                                            <option value="+12" <?php echo ($settings['timezoneoffset'] == '+12') ? 'selected' : ''; ?>>GMT +12:00 hours</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Here you can set the default timezone offset for guests and members using the default offset.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="dstcorrection" class="form-label">Day Light Savings Time?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="dstcorrection" name="configoption[dstcorrection]">
                                            <option value="1" <?php echo ($settings['dstcorrection'] == '1') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="0" <?php echo ($settings['dstcorrection'] == '0') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="If times are an hour out above and your timezone is selected correctly, enable day light savings time correction.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="datetimesep" class="form-label">Date/Time Separator</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="datetimesep" name="configoption[datetimesep]" value="<?php echo htmlspecialchars($settings['datetimesep']); ?>">
                                        <span class="input-group-text help-icon" title="Where MyBB joins date and time formats this setting is used to separate them (typically a space or comma).">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cookie Settings Tab -->
                    <div class="tab-pane fade" id="cookie-settings">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5>Cookie Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="cookiedomain" class="form-label">Cookie Domain</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="cookiedomain" name="configoption[cookiedomain]" value="<?php echo htmlspecialchars($settings['cookiedomain']); ?>">
                                        <span class="input-group-text help-icon" title="The domain which cookies should be set to. This can remain blank. It should also start with a . so it covers all subdomains.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="cookiepath" class="form-label">Cookie Path</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="cookiepath" name="configoption[cookiepath]" value="<?php echo htmlspecialchars($settings['cookiepath']); ?>">
                                        <span class="input-group-text help-icon" title="The path which cookies are set to. We recommend setting this to the full directory path to your forums with a trailing slash.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="cookieprefix" class="form-label">Cookie Prefix</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="cookieprefix" name="configoption[cookieprefix]" value="<?php echo htmlspecialchars($settings['cookieprefix']); ?>">
                                        <span class="input-group-text help-icon" title="A prefix to append to all cookies set by MyBB. This is useful if you wish to install multiple copies of MyBB on the one domain or have other software installed which conflicts with the names of the cookies in MyBB. If not specified, no prefix will be used.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="cookiesecureflag" class="form-label">Secure Cookie Flag</label>
                                    <div class="input-group">
                                        <select class="form-select" id="cookiesecureflag" name="configoption[cookiesecureflag]">
                                            <option value="1" <?php echo ($settings['cookiesecureflag'] == '1') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="0" <?php echo ($settings['cookiesecureflag'] == '0') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Cookies can be set with the Secure flag to prevent them from being sent over unencrypted connections. You should enable this setting only if your forum works correctly under HTTPS.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="cookiesamesiteflag" class="form-label">SameSite Cookie Flag</label>
                                    <div class="input-group">
                                        <select class="form-select" id="cookiesamesiteflag" name="configoption[cookiesamesiteflag]">
                                            <option value="1" <?php echo ($settings['cookiesamesiteflag'] == '1') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="0" <?php echo ($settings['cookiesamesiteflag'] == '0') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Authentication cookies will carry the SameSite flag to prevent CSRF attacks. Keep this disabled if you expect cross-origin POST requests">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>			
							
						

<!-- Avatar Settings Tab -->
                    <div class="tab-pane fade" id="avatar-settings">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5>Avatar Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="useravatar" class="form-label">Default User Avatar</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="useravatar" name="configoption[useravatar]" value="<?php echo htmlspecialchars($settings['useravatar']); ?>">
                                        <span class="input-group-text help-icon" title="If the user does not set a custom avatar this image will be used instead.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="useravatardims" class="form-label">Default Avatar Dimensions</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="useravatardims" name="configoption[useravatardims]" value="<?php echo htmlspecialchars($settings['useravatardims']); ?>">
                                        <span class="input-group-text help-icon" title="The dimensions of the default avatar; width and height separated by | or x (e.g. 40|40 or 40x40).">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="maxavatardims" class="form-label">Maximum Avatar Dimensions</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="maxavatardims" name="configoption[maxavatardims]" value="<?php echo htmlspecialchars($settings['maxavatardims']); ?>">
                                        <span class="input-group-text help-icon" title="The maximum dimensions that an avatar can be, width and height separated by | or x If this is left blank then there will be no dimension restriction.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="allowremoteavatars" class="form-label">Allow Remote Avatars</label>
                                    <div class="input-group">
                                        <select class="form-select" id="allowremoteavatars" name="configoption[allowremoteavatars]">
                                            <option value="1" <?php echo ($settings['allowremoteavatars'] == '1') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="0" <?php echo ($settings['allowremoteavatars'] == '0') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Whether to allow the usage of avatars from remote servers. Having this enabled can expose your servers IP address.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="avataruploadpath" class="form-label">Avatar Upload Path</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="avataruploadpath" name="configoption[avataruploadpath]" value="<?php echo htmlspecialchars($settings['avataruploadpath']); ?>">
                                        <span class="input-group-text help-icon" title="The path where avatars will be uploaded to.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="avatarsize" class="form-label">Maximum Avatar Size (bytes)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="avatarsize" name="configoption[avatarsize]" value="<?php echo htmlspecialchars($settings['avatarsize']); ?>">
                                        <span class="input-group-text help-icon" title="The maximum file size of avatars in bytes.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
					
					
					
					
					
					 <!-- Security Settings Tab -->
                    <div class="tab-pane fade" id="security-settings">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5>Security Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="aggressivecheckip" class="form-label">Aggressive IP Ban?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="aggressivecheckip" name="configoption[aggressivecheckip]">
                                            <option value="yes" <?php echo ($settings['aggressivecheckip'] == 'yes') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="no" <?php echo ($settings['aggressivecheckip'] == 'no') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Check banned IP's in Aggressive mode. This might decrease server load.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="aggressivecheckemail" class="form-label">Aggressive EMAIL Ban?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="aggressivecheckemail" name="configoption[aggressivecheckemail]">
                                            <option value="yes" <?php echo ($settings['aggressivecheckemail'] == 'yes') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="no" <?php echo ($settings['aggressivecheckemail'] == 'no') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Check banned EMAIL's in Aggressive mode.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="iplog1" class="form-label">Save User IP?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="iplog1" name="configoption[iplog1]">
                                            <option value="yes" <?php echo ($settings['iplog1'] == 'yes') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="no" <?php echo ($settings['iplog1'] == 'no') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="When user login with a different IP, save it into database.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="ctracker" class="form-label">Cracker Tracker Protection Enabled?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="ctracker" name="configoption[ctracker]">
                                            <option value="yes" <?php echo ($settings['ctracker'] == 'yes') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="no" <?php echo ($settings['ctracker'] == 'no') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Extra Protection against Hacker Attacks. (URL Protection)">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="iv" class="form-label">Image Verification Enabled?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="iv" name="configoption[iv]">
                                            <option value="yes" <?php echo ($iv == 'yes') ? 'selected' : ''; ?>>Yes, use Image Verification (GD/GD2).</option>
                                            <option value="reCAPTCHA" <?php echo ($iv == 'reCAPTCHA') ? 'selected' : ''; ?>>Yes, use reCAPTCHA™</option>
                                            <option value="no" <?php echo ($iv == 'no') ? 'selected' : ''; ?>>No, disabled.</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Require users to enter a Visual Verify Code to register/login/recover? (GD OR GD2 Library required)">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <?php if ($iv == 'reCAPTCHA'): ?>
                                <div class="mb-3">
                                    <label for="reCAPTCHAPublickey" class="form-label">reCAPTCHA™ Public Key</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="reCAPTCHAPublickey" name="configoption[reCAPTCHAPublickey]" value="<?php echo htmlspecialchars($reCAPTCHAPublickey); ?>">
                                        <span class="input-group-text help-icon" title="Public key provided to you by reCAPTCHA™">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="reCAPTCHAPrivatekey" class="form-label">reCAPTCHA™ Private Key</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="reCAPTCHAPrivatekey" name="configoption[reCAPTCHAPrivatekey]" value="<?php echo htmlspecialchars($reCAPTCHAPrivatekey); ?>">
                                        <span class="input-group-text help-icon" title="Private key provided to you by reCAPTCHA™">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="reCAPTCHATheme" class="form-label">reCAPTCHA™ Theme</label>
                                    <div class="input-group">
                                        <select class="form-select" id="reCAPTCHATheme" name="configoption[reCAPTCHATheme]">
                                            <option value="red" <?php echo ($reCAPTCHATheme == 'red') ? 'selected' : ''; ?>>Red</option>
                                            <option value="white" <?php echo ($reCAPTCHATheme == 'white') ? 'selected' : ''; ?>>White</option>
                                            <option value="blackglass" <?php echo ($reCAPTCHATheme == 'blackglass') ? 'selected' : ''; ?>>Black Glass</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="reCAPTCHA™ provides different themes for their CAPTCHA's. This option allows you to select the theme to use within your website.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="reCAPTCHALanguage" class="form-label">reCAPTCHA™ Language</label>
                                    <div class="input-group">
                                        <select class="form-select" id="reCAPTCHALanguage" name="configoption[reCAPTCHALanguage]">
                                            <option value="en" <?php echo ($reCAPTCHALanguage == 'en') ? 'selected' : ''; ?>>English</option>
                                            <option value="nl" <?php echo ($reCAPTCHALanguage == 'nl') ? 'selected' : ''; ?>>Dutch</option>
                                            <option value="fr" <?php echo ($reCAPTCHALanguage == 'fr') ? 'selected' : ''; ?>>French</option>
                                            <option value="de" <?php echo ($reCAPTCHALanguage == 'de') ? 'selected' : ''; ?>>German</option>
                                            <option value="pt" <?php echo ($reCAPTCHALanguage == 'pt') ? 'selected' : ''; ?>>Portuguese</option>
                                            <option value="ru" <?php echo ($reCAPTCHALanguage == 'ru') ? 'selected' : ''; ?>>Russian</option>
                                            <option value="es" <?php echo ($reCAPTCHALanguage == 'es') ? 'selected' : ''; ?>>Spanish</option>
                                            <option value="tr" <?php echo ($reCAPTCHALanguage == 'tr') ? 'selected' : ''; ?>>Turkish</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="reCAPTCHA™ provides different languages for their CAPTCHA's. This option allows you to select the default language of reCAPTCHA™">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
                                <?php endif; ?>

                                <div class="mb-3">
                                    <label for="vkeyword" class="form-label">Virtual Keyboard Enabled?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="vkeyword" name="configoption[vkeyword]">
                                            <option value="yes" <?php echo ($vkeyword == 'yes') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="no" <?php echo ($vkeyword == 'no') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Enable this feature to prevent Keylogger hacks.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="privatetrackerpatch" class="form-label">Private Tracker Patch Enabled?</label>
                                    <div class="input-group">
                                        <select class="form-select" id="privatetrackerpatch" name="configoption[privatetrackerpatch]">
                                            <option value="yes" <?php echo ($settings['privatetrackerpatch'] == 'yes') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="no" <?php echo ($settings['privatetrackerpatch'] == 'no') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Re-download is necessary for seed after upload a torrent.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>





<!-- Email Settings Tab -->
                    <div class="tab-pane fade" id="email-settings">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5>Email Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="mail_handler" class="form-label">Mail Handler</label>
                                    <div class="input-group">
                                        <select class="form-select" id="mail_handler" name="configoption[mail_handler]">
                                            <option value="mail" <?php echo ($settings['mail_handler'] == 'mail') ? 'selected' : ''; ?>>PHP Mail</option>
                                            <option value="smtp" <?php echo ($settings['mail_handler'] == 'smtp') ? 'selected' : ''; ?>>SMTP</option>
                                            <option value="sendmail" <?php echo ($settings['mail_handler'] == 'sendmail') ? 'selected' : ''; ?>>Sendmail</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Select the method your server uses to send mail.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <?php if ($settings['mail_handler'] == 'smtp'): ?>
                                <div class="mb-3">
                                    <label for="smtp_host" class="form-label">SMTP Host</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="smtp_host" name="configoption[smtp_host]" value="<?php echo htmlspecialchars($settings['smtp_host']); ?>">
                                        <span class="input-group-text help-icon" title="The hostname of your SMTP server.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="smtp_user" class="form-label">SMTP Username</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="smtp_user" name="configoption[smtp_user]" value="<?php echo htmlspecialchars($settings['smtp_user']); ?>">
                                        <span class="input-group-text help-icon" title="The username to authenticate with your SMTP server.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="smtp_pass" class="form-label">SMTP Password</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="smtp_pass" name="configoption[smtp_pass]" value="<?php echo htmlspecialchars($settings['smtp_pass']); ?>">
                                        <span class="input-group-text help-icon" title="The password to authenticate with your SMTP server.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="smtp_port" class="form-label">SMTP Port</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="smtp_port" name="configoption[smtp_port]" value="<?php echo htmlspecialchars($settings['smtp_port']); ?>">
                                        <span class="input-group-text help-icon" title="The port number to connect to your SMTP server (usually 25, 465 for SSL, or 587 for TLS).">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="secure_smtp" class="form-label">Secure SMTP</label>
                                    <div class="input-group">
                                        <select class="form-select" id="secure_smtp" name="configoption[secure_smtp]">
                                            <option value="0" <?php echo ($settings['secure_smtp'] == '0') ? 'selected' : ''; ?>>No encryption</option>
                                            <option value="1" <?php echo ($settings['secure_smtp'] == '1') ? 'selected' : ''; ?>>SSL encryption</option>
                                            <option value="2" <?php echo ($settings['secure_smtp'] == '2') ? 'selected' : ''; ?>>TLS encryption</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Select the security protocol for your SMTP connection.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
                                <?php endif; ?>

                                <div class="mb-3">
                                    <label for="mail_logging" class="form-label">Mail Logging</label>
                                    <div class="input-group">
                                        <select class="form-select" id="mail_logging" name="configoption[mail_logging]">
                                            <option value="0" <?php echo ($settings['mail_logging'] == '0') ? 'selected' : ''; ?>>None</option>
                                            <option value="1" <?php echo ($settings['mail_logging'] == '1') ? 'selected' : ''; ?>>Log emails without content</option>
                                            <option value="2" <?php echo ($settings['mail_logging'] == '2') ? 'selected' : ''; ?>>Log everything</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Select the level of email logging you require.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
								
								
								
								
								
								<div class="mb-3">
                                    <label for="mail_message_id" class="form-label">Add message ID in mail headers</label>
                                    <div class="input-group">
                                        <select class="form-select" id="mail_message_id" name="configoption[mail_message_id]">
                                            <option value="1" <?php echo ($settings['mail_message_id'] == '1') ? 'selected' : ''; ?>>Yes</option>
                                            <option value="0" <?php echo ($settings['mail_message_id'] == '0') ? 'selected' : ''; ?>>No</option>
                                        </select>
                                        <span class="input-group-text help-icon" title="Disabling this option on some shared hosts resolves issues with forum emails being marked as spam.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
								
								
								
								
								
								
								
								
								
								
								
								
								
								
								

                                <div class="mb-3">
                                    <label for="mail_queue_limit" class="form-label">Messages to send from the mail queue</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="mail_queue_limit" name="configoption[mail_queue_limit]" value="<?php echo htmlspecialchars($settings['mail_queue_limit']); ?>">
                                        <span class="input-group-text help-icon" title="The maximum number of emails that can be sent per batch when using the mail queue.">
                                            <i class="fas fa-info-circle"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>



					
</form>






<!-- Announce Settings Tab -->
<div class="tab-pane fade" id="announce-settings">
  <form method="POST" action="" id="announce-settings-form">
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Announce Settings</h5>
      </div>
      <div class="card-body">

        <div class="mb-3">
          <label for="announce_actions" class="form-label">Log Cheat Attempts?</label>
          <div class="input-group">
            <select class="form-select" id="announce_actions" name="configoption[announce_actions]">
              <option value="yes" <?= $announce_actions == 'yes' ? 'selected' : '' ?>>Yes</option>
              <option value="no" <?= $announce_actions == 'no' ? 'selected' : '' ?>>No</option>
            </select>
            <span class="input-group-text help-icon" title="Disable this for better performance.">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="aggressivecheat" class="form-label">Aggressive Cheat Detection?</label>
          <div class="input-group">
            <select class="form-select" id="aggressivecheat" name="configoption[aggressivecheat]">
              <option value="yes" <?= $aggressivecheat == 'yes' ? 'selected' : '' ?>>Yes</option>
              <option value="no" <?= $aggressivecheat == 'no' ? 'selected' : '' ?>>No</option>
            </select>
            <span class="input-group-text help-icon" title="Detect cheat tools like RatioMaster, Ratio Faker etc.">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="nc" class="form-label">Disable DL/UL?</label>
          <div class="input-group">
            <select class="form-select" id="nc" name="configoption[nc]">
              <option value="yes" <?= $nc == 'yes' ? 'selected' : '' ?>>Yes</option>
              <option value="no" <?= $nc == 'no' ? 'selected' : '' ?>>No</option>
            </select>
            <span class="input-group-text help-icon" title="Block download/upload for not connectable users.">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="announce_wait" class="form-label">Min. Announce Refresh Time?</label>
          <div class="input-group">
            <input type="text" size="10" id="announce_wait" name="configoption[announce_wait]" 
                   value="<?= htmlspecialchars($announce_wait) ?>" class="form-control">
            <span class="input-group-text help-icon" title="Minimum announce refresh time (flood limit). 0 = disabled">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="announce_interval" class="form-label">Announce Interval?</label>
          <div class="input-group">
            <input type="text" size="10" id="announce_interval" name="configoption[announce_interval]" 
                   value="<?= htmlspecialchars($announce_interval) ?>" class="form-control">
            <span class="input-group-text help-icon" title="Announce interval in seconds. Higher = better performance">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="max_rate" class="form-label">Max. Transfer Rate?</label>
          <div class="input-group">
            <input type="text" size="10" id="max_rate" name="configoption[max_rate]" 
                   value="<?= htmlspecialchars($max_rate) ?>" class="form-control">
            <span class="input-group-text help-icon" title="Detect suspicious speeds if above this rate">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="bannedclientdetect" class="form-label">Banned Client Detection?</label>
          <div class="input-group">
            <select class="form-select" id="bannedclientdetect" name="configoption[bannedclientdetect]">
              <option value="yes" <?= $bannedclientdetect == 'yes' ? 'selected' : '' ?>>Yes</option>
              <option value="no" <?= $bannedclientdetect == 'no' ? 'selected' : '' ?>>No</option>
            </select>
            <span class="input-group-text help-icon" title="Allow only clients from whitelist if enabled">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="allowed_clients" class="form-label">Allowed Clients</label>
          <div class="input-group">
            <textarea name="configoption[allowed_clients]" rows="4" class="form-control"><?= htmlspecialchars($allowed_clients) ?></textarea>
            <span class="input-group-text help-icon" title="Whitelist of allowed clients">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="detectbrowsercheats" class="form-label">Detect Browser Cheats?</label>
          <div class="input-group">
            <select class="form-select" id="detectbrowsercheats" name="configoption[detectbrowsercheats]">
              <option value="yes" <?= $detectbrowsercheats == 'yes' ? 'selected' : '' ?>>Yes</option>
              <option value="no" <?= $detectbrowsercheats == 'no' ? 'selected' : '' ?>>No</option>
            </select>
            <span class="input-group-text help-icon" title="Detect browser-based cheat attempts">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="checkconnectable" class="form-label">Detect Connectable?</label>
          <div class="input-group">
            <select class="form-select" id="checkconnectable" name="configoption[checkconnectable]">
              <option value="yes" <?= $checkconnectable == 'yes' ? 'selected' : '' ?>>Yes</option>
              <option value="no" <?= $checkconnectable == 'no' ? 'selected' : '' ?>>No</option>
            </select>
            <span class="input-group-text help-icon" title="Decreases performance if enabled">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="checkip" class="form-label">Check IP?</label>
          <div class="input-group">
            <select class="form-select" id="checkip" name="configoption[checkip]">
              <option value="yes" <?= $checkip == 'yes' ? 'selected' : '' ?>>Yes</option>
              <option value="no" <?= $checkip == 'no' ? 'selected' : '' ?>>No</option>
            </select>
            <span class="input-group-text help-icon" title="Match user’s last IP in DB with client IP">
              <i class="fas fa-info-circle"></i>
            </span>
          </div>
        </div>
		
		
		
<div class="mb-3">
    <label for="mysql_host" class="form-label">MYSQL Host</label>
    <div class="input-group">
        <input type="text" class="form-control" id="mysql_host" name="configoption[mysql_host]" value="<?php echo htmlspecialchars($mysql_host); ?>">
        <span class="input-group-text help-icon" title="Please enter your MySQL host name here.">
            <i class="fas fa-info-circle"></i>
        </span>
    </div>
</div>

<div class="mb-3">
    <label for="mysql_user" class="form-label">MYSQL User</label>
    <div class="input-group">
        <input type="text" class="form-control" id="mysql_user" name="configoption[mysql_user]" value="<?php echo htmlspecialchars($mysql_user); ?>">
        <span class="input-group-text help-icon" title="Please enter your MySQL user name here.">
            <i class="fas fa-info-circle"></i>
        </span>
    </div>
</div>

<div class="mb-3">
    <label for="mysql_pass" class="form-label">MYSQL Password</label>
    <div class="input-group">
        <input type="password" class="form-control" id="mysql_pass" name="configoption[mysql_pass]" value="">
        <span class="input-group-text help-icon" title="Please enter your MySQL password here.">
            <i class="fas fa-info-circle"></i>
        </span>
    </div>
</div>

<div class="mb-3">
    <label for="mysql_db" class="form-label">MYSQL Database Name</label>
    <div class="input-group">
        <input type="text" class="form-control" id="mysql_db" name="configoption[mysql_db]" value="<?php echo htmlspecialchars($mysql_db); ?>">
        <span class="input-group-text help-icon" title="Please enter your MySQL database name here.">
            <i class="fas fa-info-circle"></i>
        </span>
    </div>
</div>

		
		
		
		

        <!-- Save button -->
        <div class="d-flex justify-content-end mt-4">
          <button type="submit" name="save_announce" class="btn btn-primary px-4">
            <i class="fas fa-save me-2"></i> Save Changes
          </button>
        </div>
      </div>
    </div>
  </form>
</div>






<!-- Registration Settings Tab -->
<div class="tab-pane fade" id="registration-settings">
  <form method="POST" action="" id="registration-settings-form">
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Registration Settings</h5>
      </div>
      <div class="card-body">
        
        <div class="mb-4">
          <h6 class="mb-3 border-bottom pb-2">Registration System</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="invitesystem" class="form-label">Invite System</label>
              <div class="input-group">
                <select class="form-select" id="invitesystem" name="configoption[invitesystem]">
                  <option value="on" <?= $invitesystem == 'on' ? 'selected' : '' ?>>Enabled</option>
                  <option value="off" <?= $invitesystem == 'off' ? 'selected' : '' ?>>Disabled</option>
                </select>
                <span class="input-group-text help-icon" title="Enable invite-only registration system">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="regtype" class="form-label">Registration Method</label>
              <div class="input-group">
                <select class="form-select" id="regtype" name="configoption[regtype]">
                  <option value="invite" <?= $regtype == 'invite' ? 'selected' : '' ?>>Invite System</option>
                  <option value="instant" <?= $regtype == 'instant' ? 'selected' : '' ?>>Instant Activation</option>
                  <option value="verify" <?= $regtype == 'verify' ? 'selected' : '' ?>>Email Verification</option>
                  <option value="randompass" <?= $regtype == 'randompass' ? 'selected' : '' ?>>Random Password</option>
                  <option value="admin" <?= $regtype == 'admin' ? 'selected' : '' ?>>Admin Activation</option>
                  <option value="both" <?= $regtype == 'both' ? 'selected' : '' ?>>Email + Admin Activation</option>
                </select>
                <span class="input-group-text help-icon" title="Select how new users will activate their accounts">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Username Settings -->
        <div class="mb-4">
          <h6 class="mb-3 border-bottom pb-2">Username Requirements</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="minnamelength" class="form-label">Min Username Length</label>
              <div class="input-group">
                <input type="number" class="form-control" id="minnamelength" 
                       name="configoption[minnamelength]" value="<?= htmlspecialchars($minnamelength) ?>">
                <span class="input-group-text help-icon" title="Minimum characters required for usernames">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label for="maxnamelength" class="form-label">Max Username Length</label>
              <div class="input-group">
                <input type="number" class="form-control" id="maxnamelength" 
                       name="configoption[maxnamelength]" value="<?= htmlspecialchars($maxnamelength) ?>">
                <span class="input-group-text help-icon" title="Maximum characters allowed for usernames">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label for="maxip" class="form-label">Max. IP's</label>
              <div class="input-group">
                <input type="number" class="form-control" id="maxip" 
                       name="configoption[maxip]" value="<?= htmlspecialchars($maxip) ?>">
                <span class="input-group-text help-icon" title="Disable registration with same IP Address. Leave it 'disable' to disable this feature">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for="illegalusernames" class="form-label">Banned Usernames</label>
            <div class="input-group">
              <textarea class="form-control" id="illegalusernames" name="configoption[illegalusernames]" rows="3"><?= htmlspecialchars($illegalusernames) ?></textarea>
              <span class="input-group-text help-icon" title="Space-separated list of banned username fragments">
                <i class="fas fa-info-circle"></i>
              </span>
            </div>
          </div>
        </div>

        <!-- Password Settings -->
        <div class="mb-4">
          <h6 class="mb-3 border-bottom pb-2">Password Requirements</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="minpasswordlength" class="form-label">Min Password Length</label>
              <div class="input-group">
                <input type="number" class="form-control" id="minpasswordlength" 
                       name="configoption[minpasswordlength]" value="<?= htmlspecialchars($minpasswordlength) ?>">
                <span class="input-group-text help-icon" title="Minimum characters required for passwords">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="maxpasswordlength" class="form-label">Max Password Length</label>
              <div class="input-group">
                <input type="number" class="form-control" id="maxpasswordlength" 
                       name="configoption[maxpasswordlength]" value="<?= htmlspecialchars($maxpasswordlength) ?>">
                <span class="input-group-text help-icon" title="Maximum characters allowed for passwords">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for="requirecomplexpasswords" class="form-label">Complex Passwords</label>
            <div class="input-group">
              <select class="form-select" id="requirecomplexpasswords" name="configoption[requirecomplexpasswords]">
                <option value="1" <?= $requirecomplexpasswords == '1' ? 'selected' : '' ?>>Required</option>
                <option value="0" <?= $requirecomplexpasswords == '0' ? 'selected' : '' ?>>Not Required</option>
              </select>
              <span class="input-group-text help-icon" title="Require uppercase, lowercase and numbers in passwords">
                <i class="fas fa-info-circle"></i>
              </span>
            </div>
          </div>
        </div>

        <!-- Security Settings -->
        <div class="mb-4">
          <h6 class="mb-3 border-bottom pb-2">Security Settings</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="failedlogincount" class="form-label">Number of times to allow failed logins</label>
              <div class="input-group">
                <input type="number" class="form-control" id="failedlogincount" 
                       name="configoption[failedlogincount]" value="<?= htmlspecialchars($failedlogincount) ?>">
                <span class="input-group-text help-icon" title="Number of allowed failed login attempts (0 to disable)">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="failedlogintext" class="form-label">Display number of failed logins</label>
              <div class="input-group">
                <select class="form-select" id="failedlogintext" name="configoption[failedlogintext]">
                  <option value="1" <?= $failedlogintext == '1' ? 'selected' : '' ?>>Yes</option>
                  <option value="0" <?= $failedlogintext == '0' ? 'selected' : '' ?>>No</option>
                </select>
                <span class="input-group-text help-icon" title="Show users how many login attempts remain">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="username_method" class="form-label">Allowed Login Methods</label>
              <div class="input-group">
                <select class="form-select" id="username_method" name="configoption[username_method]">
                  <option value="0" <?= $username_method == '0' ? 'selected' : '' ?>>Username Only</option>
                  <option value="1" <?= $username_method == '1' ? 'selected' : '' ?>>Email Only</option>
                  <option value="2" <?= $username_method == '2' ? 'selected' : '' ?>>Both Username and Email</option>
                </select>
                <span class="input-group-text help-icon" title="Allowed login identification methods">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="disableregs" class="form-label">Disable Registrations</label>
              <div class="input-group">
                <select class="form-select" id="disableregs" name="configoption[disableregs]">
                  <option value="1" <?= $disableregs == '1' ? 'selected' : '' ?>>Yes</option>
                  <option value="0" <?= $disableregs == '0' ? 'selected' : '' ?>>No</option>
                </select>
                <span class="input-group-text help-icon" title="Temporarily disable new registrations">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label for="r_verification" class="form-label">Verification Fields</label>
              <div class="input-group">
                <select class="form-select" id="r_verification" name="configoption[r_verification]">
                  <option value="yes" <?= $r_verification == 'yes' ? 'selected' : '' ?>>Yes</option>
                  <option value="no" <?= $r_verification == 'no' ? 'selected' : '' ?>>No</option>
                </select>
                <span class="input-group-text help-icon" title="User must agree rules before registering">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label for="maxusers" class="form-label">Max Users</label>
              <div class="input-group">
                <input type="number" class="form-control" id="maxusers" 
                       name="configoption[maxusers]" value="<?= htmlspecialchars($maxusers) ?>">
                <span class="input-group-text help-icon" title="Disable registration whenever this limit will be reached">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Additional Settings -->
        <div class="mb-4">
          <h6 class="mb-3 border-bottom pb-2">Additional Settings</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="coppa" class="form-label">COPPA Compliance</label>
              <div class="input-group">
                <select class="form-select" id="coppa" name="configoption[coppa]">
                  <option value="enabled" <?= $coppa == 'enabled' ? 'selected' : '' ?>>Enabled</option>
                  <option value="deny" <?= $coppa == 'deny' ? 'selected' : '' ?>>Deny users under 13</option>
                  <option value="disabled" <?= $coppa == 'disabled' ? 'selected' : '' ?>>Disabled</option>
                </select>
                <span class="input-group-text help-icon" title="Children's Online Privacy Protection Act settings">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="default_usergroup" class="form-label">Default Usergroup</label>
              <div class="input-group">
                <select class="form-select" id="default_usergroup" name="configoption[_d_usergroup]">
                  <?php 
                  $squery = $db->sql_query('SELECT gid, title, namestyle FROM usergroups');
                  while ($gid = mysqli_fetch_assoc($squery)): 
                  ?>
                    <option value="<?= $gid['gid'] ?>" <?= $_d_usergroup == $gid['gid'] ? 'selected' : '' ?>>
                      <?= get_user_color($gid['title'], $gid['namestyle']) ?>
                    </option>
                  <?php endwhile; ?>
                </select>
                <span class="input-group-text help-icon" title="Default group for new registrations">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4 mb-3">
              <label for="invite_count" class="form-label">Initial Invites</label>
              <div class="input-group">
                <input type="number" class="form-control" id="invite_count" 
                       name="configoption[invite_count]" value="<?= htmlspecialchars($invite_count) ?>">
                <span class="input-group-text help-icon" title="Invites given to new users (0 to disable)">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <label for="autogigsignup" class="form-label">Auto GB on Signup</label>
              <div class="input-group">
                <input type="number" class="form-control" id="autogigsignup" 
                       name="configoption[autogigsignup]" value="<?= htmlspecialchars($autogigsignup) ?>">
                <span class="input-group-text help-icon" title="GB given to new users (0 to disable)">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <label for="autosbsignup" class="form-label">Auto SeedBonus</label>
              <div class="input-group">
                <input type="number" class="form-control" id="autosbsignup" 
                       name="configoption[autosbsignup]" value="<?= htmlspecialchars($autosbsignup) ?>">
                <span class="input-group-text help-icon" title="SeedBonus given to new users (0 to disable)">
                  <i class="fas fa-info-circle"></i>
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Save Button -->
        <div class="d-flex justify-content-end mt-4">
          <button type="submit" name="save_registration" class="btn btn-primary px-4">
            <i class="fas fa-save me-2"></i> Save Changes
          </button>
        </div>
      </div> <!-- .card-body -->
    </div> <!-- .card -->
  </form>
</div> <!-- .tab-pane -->









<!-- Cleanup Settings Tab -->
<div class="tab-pane fade" id="user-management-settings">
  <form method="POST" action="" id="user-management-form">
    <div class="card mb-4">
      <div class="card-header">
        <h5>Cleanup Settings</h5>
      </div>
      <div class="card-body">





<!-- Automatic Invites Section -->
            <div class="mb-3">
                <label for="ai" class="form-label">Automatic Invite?</label>
                <div class="input-group">
                    <select class="form-select" id="ai" name="configoption[ai]">
                        <option value="yes" <?php echo ($ai == 'yes') ? 'selected' : ''; ?>>Yes</option>
                        <option value="no" <?php echo ($ai == 'no') ? 'selected' : ''; ?>>No</option>
                    </select>
                    <span class="input-group-text help-icon" title="Give x Invites every <?php echo $autoinvitetime; ?> days if usergroup have this feature.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="autoinvitetime" class="form-label">Automatic Invite Time (days)</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="autoinvitetime" name="configoption[autoinvitetime]" value="<?php echo htmlspecialchars($autoinvitetime); ?>">
                    <span class="input-group-text help-icon" title="Give x Invites every X days if usergroup have this feature.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <!-- Torrent Settings Section -->
            <div class="mb-3">
                <label for="max_dead_torrent_time" class="form-label">Mark Torrents Invisible After (days)</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="max_dead_torrent_time" name="configoption[max_dead_torrent_time]" value="<?php echo htmlspecialchars($max_dead_torrent_time); ?>">
                    <span class="input-group-text help-icon" title="Mark torrents as invisible after X days. (Torrent Last Action < X days)">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <!-- Promotion Settings Section -->
            <div class="card-header d-flex justify-content-between align-items-center mt-4">
                <h5 class="mb-0">User Promotion Settings</h5>
            </div>

            <div class="mb-3 mt-3">
                <label for="promote_gig_limit" class="form-label">Promote Users GB Limit</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="promote_gig_limit" name="configoption[promote_gig_limit]" value="<?php echo htmlspecialchars($promote_gig_limit); ?>">
                    <span class="input-group-text help-icon" title="Once Regular User reach this Limit, his/her account will be promoted automatically to Power User. Leave 0 to disable this feature.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="promote_min_ratio" class="form-label">Promote Users RATIO Limit</label>
                <div class="input-group">
                    <input type="number" step="0.01" class="form-control" id="promote_min_ratio" name="configoption[promote_min_ratio]" value="<?php echo htmlspecialchars($promote_min_ratio); ?>">
                    <span class="input-group-text help-icon" title="Once Regular User reach this Limit, his/her account will be promoted automatically to Power User.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="promote_min_reg_days" class="form-label">Promote Users DAYS Limit</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="promote_min_reg_days" name="configoption[promote_min_reg_days]" value="<?php echo htmlspecialchars($promote_min_reg_days); ?>">
                    <span class="input-group-text help-icon" title="Min. DAYS Limit for promote.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="demote_min_ratio" class="form-label">Demote Users RATIO Limit</label>
                <div class="input-group">
                    <input type="number" step="0.01" class="form-control" id="demote_min_ratio" name="configoption[demote_min_ratio]" value="<?php echo htmlspecialchars($demote_min_ratio); ?>">
                    <span class="input-group-text help-icon" title="Whenever user have below ratio from this limit, his/her account will be demoted automatically to User.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="referrergift" class="form-label">Referrer Gift (GB)</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="referrergift" name="configoption[referrergift]" value="<?php echo htmlspecialchars($referrergift); ?>">
                    <span class="input-group-text help-icon" title="Referrer will receive X GB Upload when his referred users reach Power User Level.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <!-- Warning Settings Section -->
            <div class="card-header d-flex justify-content-between align-items-center mt-4">
                <h5 class="mb-0">User Warning Settings</h5>
            </div>

            <div class="mb-3 mt-3">
                <label for="leechwarn_min_ratio" class="form-label">Warn User MIN. Ratio</label>
                <div class="input-group">
                    <input type="number" step="0.01" class="form-control" id="leechwarn_min_ratio" name="configoption[leechwarn_min_ratio]" value="<?php echo htmlspecialchars($leechwarn_min_ratio); ?>">
                    <span class="input-group-text help-icon" title="Min. Ratio for LeechWarning.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="leechwarn_gig_limit" class="form-label">Warn User GB Limit</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="leechwarn_gig_limit" name="configoption[leechwarn_gig_limit]" value="<?php echo htmlspecialchars($leechwarn_gig_limit); ?>">
                    <span class="input-group-text help-icon" title="Min. GB Limit for LeechWarning.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="leechwarn_length" class="form-label">Warning Length (weeks)</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="leechwarn_length" name="configoption[leechwarn_length]" value="<?php echo htmlspecialchars($leechwarn_length); ?>">
                    <span class="input-group-text help-icon" title="LeechWarning Length (weeks).">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="leechwarn_remove_ratio" class="form-label">Remove Warning Min. Ratio</label>
                <div class="input-group">
                    <input type="number" step="0.01" class="form-control" id="leechwarn_remove_ratio" name="configoption[leechwarn_remove_ratio]" value="<?php echo htmlspecialchars($leechwarn_remove_ratio); ?>">
                    <span class="input-group-text help-icon" title="Min. Ratio Limit to Remove LeechWarning.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="ban_user_limit" class="form-label">Ban Warned Users After X Warnings</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="ban_user_limit" name="configoption[ban_user_limit]" value="<?php echo htmlspecialchars($ban_user_limit); ?>">
                    <span class="input-group-text help-icon" title="Once an user has reached this limit, he will be automatically banned.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>
			
			
	<div class="d-flex justify-content-end mt-4">
          <button type="submit" name="save_user_management" class="btn btn-primary px-4">
            <i class="fas fa-save me-2"></i> Save Changes
          </button>
        </div>
      </div> <!-- .card-body -->
    </div> <!-- .card -->
  </form>
</div> <!-- .tab-pane -->	










<!-- KPS (Bonus Points) System Settings Tab -->
<div class="tab-pane fade" id="kps-settings">
  <form method="POST" action="" id="kps-settings-form">
    <div class="card mb-4">
      <div class="card-header">
        <h5>KPS (Bonus Points) System Settings</h5>
      </div>
      <div class="card-body">

        
		
		  <div class="mb-3">
                <label for="bonus" class="form-label">KPS System Enabled?</label>
                <div class="input-group">
                    <select class="form-select" id="bonus" name="configoption[bonus]">
                        <option value="enable" <?php echo ($bonus == 'enable') ? 'selected' : ''; ?>>Yes, Enabled</option>
                        <option value="disablesave" <?php echo ($bonus == 'disablesave') ? 'selected' : ''; ?>>No, But Save Points</option>
                        <option value="disable" <?php echo ($bonus == 'disable') ? 'selected' : ''; ?>>No, Disabled</option>
                    </select>
                    <span class="input-group-text help-icon" title="Once user earn points by seeding a torrent, posting a comment etc. they can trade this points on KPS page.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpsseed" class="form-label">Seed Point</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="kpsseed" name="configoption[kpsseed]" value="<?php echo htmlspecialchars($kpsseed); ?>">
                    <span class="input-group-text help-icon" title="This points depending on your Announce Interval value. Example: Set this to 0.5 and set Announce Interval to 1800 so seeders will get 1 point per hour.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpsupload" class="form-label">Upload Point</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="kpsupload" name="configoption[kpsupload]" value="<?php echo htmlspecialchars($kpsupload); ?>">
                    <span class="input-group-text help-icon" title="Give seeding bonus when user upload a torrent.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpscomment" class="form-label">Post/Comment/Thread Point</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="kpscomment" name="configoption[kpscomment]" value="<?php echo htmlspecialchars($kpscomment); ?>">
                    <span class="input-group-text help-icon" title="Give seeding bonus when user submit a comment/post/thread.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpsthanks" class="form-label">Thanks Point</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="kpsthanks" name="configoption[kpsthanks]" value="<?php echo htmlspecialchars($kpsthanks); ?>">
                    <span class="input-group-text help-icon" title="Give seeding bonus when user say thanks.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpsrate" class="form-label">Rating Point</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="kpsrate" name="configoption[kpsrate]" value="<?php echo htmlspecialchars($kpsrate); ?>">
                    <span class="input-group-text help-icon" title="Give seeding bonus when user rate a torrent.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpspoll" class="form-label">Poll Point</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="kpspoll" name="configoption[kpspoll]" value="<?php echo htmlspecialchars($kpspoll); ?>">
                    <span class="input-group-text help-icon" title="Give seeding bonus when user vote a poll.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpsmaxpoint" class="form-label">Max. Bonus Point</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="kpsmaxpoint" name="configoption[kpsmaxpoint]" value="<?php echo htmlspecialchars($kpsmaxpoint); ?>">
                    <span class="input-group-text help-icon" title="Once user reach this limit he can only use trade for GIFT!">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpsinvite" class="form-label">Enable Invite Usage?</label>
                <div class="input-group">
                    <select class="form-select" id="kpsinvite" name="configoption[kpsinvite]">
                        <option value="yes" <?php echo ($kpsinvite == 'yes') ? 'selected' : ''; ?>>Yes</option>
                        <option value="no" <?php echo ($kpsinvite == 'no') ? 'selected' : ''; ?>>No</option>
                    </select>
                    <span class="input-group-text help-icon" title="Enable/Disable Invite Gift for KPS Page.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpstitle" class="form-label">Enable Custom Title Usage?</label>
                <div class="input-group">
                    <select class="form-select" id="kpstitle" name="configoption[kpstitle]">
                        <option value="yes" <?php echo ($kpstitle == 'yes') ? 'selected' : ''; ?>>Yes</option>
                        <option value="no" <?php echo ($kpstitle == 'no') ? 'selected' : ''; ?>>No</option>
                    </select>
                    <span class="input-group-text help-icon" title="Enable/Disable Custom Title Gift for KPS Page.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpsvip" class="form-label">Enable VIP Status Usage?</label>
                <div class="input-group">
                    <select class="form-select" id="kpsvip" name="configoption[kpsvip]">
                        <option value="yes" <?php echo ($kpsvip == 'yes') ? 'selected' : ''; ?>>Yes</option>
                        <option value="no" <?php echo ($kpsvip == 'no') ? 'selected' : ''; ?>>No</option>
                    </select>
                    <span class="input-group-text help-icon" title="Enable/Disable VIP Gift for KPS Page.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpsgift" class="form-label">Enable Give A Karma Gift Usage?</label>
                <div class="input-group">
                    <select class="form-select" id="kpsgift" name="configoption[kpsgift]">
                        <option value="yes" <?php echo ($kpsgift == 'yes') ? 'selected' : ''; ?>>Yes</option>
                        <option value="no" <?php echo ($kpsgift == 'no') ? 'selected' : ''; ?>>No</option>
                    </select>
                    <span class="input-group-text help-icon" title="Enable/Disable Give A Karma Gift Usage for KPS Page.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpswarning" class="form-label">Enable Remove Warning Usage?</label>
                <div class="input-group">
                    <select class="form-select" id="kpswarning" name="configoption[kpswarning]">
                        <option value="yes" <?php echo ($kpswarning == 'yes') ? 'selected' : ''; ?>>Yes</option>
                        <option value="no" <?php echo ($kpswarning == 'no') ? 'selected' : ''; ?>>No</option>
                    </select>
                    <span class="input-group-text help-icon" title="Enable/Disable Remove Warning Usage for KPS Page.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="kpsratiofix" class="form-label">Enable Fix Torrent Ratio Usage?</label>
                <div class="input-group">
                    <select class="form-select" id="kpsratiofix" name="configoption[kpsratiofix]">
                        <option value="yes" <?php echo ($kpsratiofix == 'yes') ? 'selected' : ''; ?>>Yes</option>
                        <option value="no" <?php echo ($kpsratiofix == 'no') ? 'selected' : ''; ?>>No</option>
                    </select>
                    <span class="input-group-text help-icon" title="Enable/Disable Fix Torrent Ratio Usage for KPS Page.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="card-header d-flex justify-content-between align-items-center mt-4">
                <h5 class="mb-0">Birthday Reward Settings</h5>
            </div>

            <div class="mb-3 mt-3">
                <label for="bdayreward" class="form-label">Birthday Reward System Enabled?</label>
                <div class="input-group">
                    <select class="form-select" id="bdayreward" name="configoption[bdayreward]">
                        <option value="yes" <?php echo ($bdayreward == 'yes') ? 'selected' : ''; ?>>Yes</option>
                        <option value="no" <?php echo ($bdayreward == 'no') ? 'selected' : ''; ?>>No</option>
                    </select>
                    <span class="input-group-text help-icon" title="Free/Silver/Double leech/seed on user's birthday!">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>

            <div class="mb-3">
                <label for="bdayrewardtype" class="form-label">Birthday Reward Type</label>
                <div class="input-group">
                    <select class="form-select" id="bdayrewardtype" name="configoption[bdayrewardtype]">
                        <option value="freeleech" <?php echo ($bdayrewardtype == 'freeleech') ? 'selected' : ''; ?>>Free Leech</option>
                        <option value="silverleech" <?php echo ($bdayrewardtype == 'silverleech') ? 'selected' : ''; ?>>Silver Leech</option>
                        <option value="doubleupload" <?php echo ($bdayrewardtype == 'doubleupload') ? 'selected' : ''; ?>>x2 Upload</option>
                    </select>
                    <span class="input-group-text help-icon" title="Select Birthday Reward Type:
                    Free Leech: Free Torrents download when set gives the users upload credit only and no download credit is posted to the users stats.
                    Silver Leech: Silver Torrents when set only record 50% of the users download credit on that file.
                    x2 Upload: x2 Double Upload Credit for seeding back files.">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </div>
            </div>
		
		
		

        <!-- Кнопка отправки -->
        <div class="d-flex justify-content-end mt-4">
          <button type="submit" name="save_kps" class="btn btn-primary px-4">
            <i class="fas fa-save me-2"></i> Save Changes
          </button>
        </div>
      </div>
    </div>
  </form>
</div>





















<?php
// Read current staff team
$filename = CONFIG_DIR . '/STAFFTEAM';
$staffarray = [];

if (file_exists($filename) && is_readable($filename)) {
    $staffteam = file_get_contents($filename);
    if ($staffteam !== false) {
        $staffEntries = explode(',', $staffteam);
        foreach ($staffEntries as $entry) {
            $entry = trim($entry);
            if (!empty($entry)) {
                $staffParts = explode(':', $entry, 2);
                if (count($staffParts) === 2) {
                    $staffarray[] = [
                        'name' => trim($staffParts[0]),
                        'id'   => trim($staffParts[1])
                    ];
                }
            }
        }
    }
}

// Fetch all available staff for autocomplete
$availableStaff = [];
$query = $db->sql_query("
    SELECT u.id, u.username, g.title 
    FROM users u 
    LEFT JOIN usergroups g ON (u.usergroup = g.gid) 
    WHERE u.enabled = 'yes' 
    AND (g.cansettingspanel = '1' OR g.issupermod = '1' OR g.canstaffpanel = '1')
    ORDER BY u.username ASC
");

if ($db->num_rows($query) > 0) {
    while ($row = $db->fetch_array($query)) {
        $availableStaff[] = [
            'id'       => $row['id'],
            'username' => $row['username'],
            'group'    => $row['title']
        ];
    }
}
?>

<style>
    table.table tbody tr:hover {
        background-color: #f8f9fa;
        transition: background-color 0.3s ease;
    }

    input.bg-success {
        transition: background-color 0.8s ease;
    }

    .btn:hover {
        transform: scale(1.05);
        transition: transform 0.2s ease;
    }

    .modal-header {
        background: linear-gradient(90deg, #0d6efd, #0b5ed7);
    }

    .modal-header h5 {
        font-weight: bold;
    }

    .gradient-header {
        background: linear-gradient(90deg, #0d6efd, #0b5ed7);
        color: white;
    }

    .gradient-header .badge {
        background: rgba(255, 255, 255, 0.2);
        color: white;
    }
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // Smooth auto-close for alerts
    ['staff-success', 'staff-error'].forEach(function (id) {
        const alertBox = document.getElementById(id);
        if (alertBox) {
            setTimeout(() => {
                bootstrap.Alert.getOrCreateInstance(alertBox).close();
            }, id === 'staff-success' ? 2500 : 5000);
        }
    });

    // Auto-fill ID when typing username
    const staffData = <?php echo json_encode($availableStaff); ?>;
    document.querySelectorAll('input[name="staffnames[]"]').forEach(input => {
        input.addEventListener('input', function () {
            const username = this.value.trim();
            const idInput = this.closest('tr').querySelector('input[name="staffids[]"]');
            if (username) {
                const user = staffData.find(u => u.username.toLowerCase() === username.toLowerCase());
                if (user && !idInput.value) {
                    idInput.value = user.id;
                    idInput.classList.add('bg-success', 'bg-opacity-25');
                    setTimeout(() => idInput.classList.remove('bg-success', 'bg-opacity-25'), 1500);
                }
            }
        });
    });

    // Form validation
    document.querySelector('form').addEventListener('submit', function(e) {
        let hasErrors = false;
        document.querySelectorAll('tbody tr').forEach(row => {
            const name = row.querySelector('input[name="staffnames[]"]').value.trim();
            const id = row.querySelector('input[name="staffids[]"]').value.trim();
            if ((name && !id) || (!name && id)) {
                hasErrors = true;
                row.classList.add('table-danger');
                setTimeout(() => row.classList.remove('table-danger'), 2000);
            }
        });
        if (hasErrors) {
            e.preventDefault();
            alert('⚠ Please fill in both Username and ID for each entry, or leave both fields empty.');
        }
    });

    // Initialize tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(el => new bootstrap.Tooltip(el));
});

function findUser() {
    window.open('<?php echo htmlspecialchars($BASEURL); ?>/users.php#searchuser', 'finduser',
        'toolbar=no,scrollbars=yes,resizable=no,width=800,height=600,top=50,left=50');
}
</script>

<!-- Staff Team Management Tab -->
<div class="tab-pane fade" id="staff-team">
    <div class="card mb-4 shadow-sm">
        <div class="card-header gradient-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-users-cog me-2"></i> Staff Team Management</h5>
            <span class="badge rounded-pill shadow-sm">
                <i class="fas fa-user me-1"></i><?php echo count($staffarray); ?>
            </span>
        </div>
        <div class="card-body">
            <div class="alert alert-info mb-4">
                <i class="fas fa-lightbulb me-2"></i> <strong>Tip:</strong>
                Add new members in green rows, or use <strong>"Find User"</strong> for quick ID lookup.
            </div>

            <form method="POST" action="<?php echo htmlspecialchars($_SERVER['PHP_SELF']); ?>">
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th width="5%">#</th>
                                <th width="47%">Username</th>
                                <th width="43%">User ID</th>
                                <th width="5%">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php if (!empty($staffarray)): ?>
                                <?php foreach ($staffarray as $index => $staff): ?>
                                <tr>
                                    <td class="text-center fw-bold"><?php echo $index + 1; ?></td>
                                    <td>
                                        <input type="text" name="staffnames[]"
                                               value="<?php echo htmlspecialchars($staff['name']); ?>"
                                               class="form-control"
                                               placeholder="Enter username"
                                               list="staffNames">
                                    </td>
                                    <td>
                                        <input type="text" name="staffids[]"
                                               value="<?php echo htmlspecialchars($staff['id']); ?>"
                                               class="form-control"
                                               placeholder="Enter user ID">
                                    </td>
                                    <td class="text-center">
                                        <button type="button" class="btn btn-sm btn-outline-danger"
                                                data-bs-toggle="tooltip" title="Clear this row"
                                                onclick="this.closest('tr').querySelectorAll('input').forEach(i => i.value = '')">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </td>
                                </tr>
                                <?php endforeach; ?>
                            <?php else: ?>
                                <tr>
                                    <td colspan="4" class="text-center text-muted py-5">
                                        <i class="fas fa-users-slash fa-3x mb-3 opacity-50"></i>
                                        <p class="mb-0 fw-semibold">No staff members found</p>
                                        <small class="text-muted">Add your first team member below</small>
                                    </td>
                                </tr>
                            <?php endif; ?>

                            <!-- Empty rows for new entries -->
                            <?php for ($i = 0; $i < 3; $i++): ?>
                                <tr class="table-success">
                                    <td class="text-center">
                                        <span class="badge bg-success rounded-pill">New</span>
                                    </td>
                                    <td>
                                        <input type="text" name="staffnames[]" class="form-control"
                                               placeholder="Enter username"
                                               list="staffNames">
                                    </td>
                                    <td>
                                        <input type="text" name="staffids[]" class="form-control"
                                               placeholder="Enter user ID">
                                    </td>
                                    <td></td>
                                </tr>
                            <?php endfor; ?>
                        </tbody>
                    </table>
                </div>

                <!-- Autocomplete datalist -->
                <datalist id="staffNames">
                    <?php foreach ($availableStaff as $staff): ?>
                        <option value="<?php echo htmlspecialchars($staff['username']); ?>">
                            <?php echo htmlspecialchars($staff['username']); ?> (<?php echo htmlspecialchars($staff['group']); ?>)
                        </option>
                    <?php endforeach; ?>
                </datalist>

                <div class="d-flex justify-content-between align-items-center mt-4 p-3 bg-light rounded shadow-sm">
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#helpModal">
                            <i class="fas fa-question-circle me-2"></i> Help Guide
                        </button>
                        <button type="button" onclick="findUser()" class="btn btn-outline-primary">
                            <i class="fas fa-search me-2"></i> Find User
                        </button>
                    </div>
                    <div class="d-flex align-items-center gap-3">
                        <span class="text-muted small">
                            <i class="fas fa-database me-1"></i>
                            <?php echo count($availableStaff); ?> available staff members
                        </span>
                        <button type="submit" name="save_staff" class="btn btn-primary px-4 shadow-sm">
                            <i class="fas fa-save me-2"></i> Save Changes
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content shadow-lg">
            <div class="modal-header">
                <h5 class="modal-title text-white">
                    <i class="fas fa-life-ring me-2"></i> Staff Management Guide
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-success mb-3">
                            <div class="card-header bg-success text-white">
                                <i class="fas fa-plus-circle me-2"></i> Adding Members
                            </div>
                            <div class="card-body">
                                <ol>
                                    <li>Type the username in a green row</li>
                                    <li>The user ID will auto-fill if found</li>
                                    <li>Use the <strong>Find User</strong> button for manual search</li>
                                    <li>Click <strong>Save Changes</strong></li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-danger mb-3">
                            <div class="card-header bg-danger text-white">
                                <i class="fas fa-times-circle me-2"></i> Removing Members
                            </div>
                            <div class="card-body">
                                <ol>
                                    <li>Click the red X button, or</li>
                                    <li>Clear both the Username and ID fields</li>
                                    <li>Click <strong>Save Changes</strong> to confirm</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="alert alert-warning mt-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Important:</strong> Changes take effect immediately. Make sure both fields are filled for each entry.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary shadow-sm" data-bs-dismiss="modal">
                    <i class="fas fa-check me-2"></i> Got It
                </button>
            </div>
        </div>
    </div>
</div>































<!-- FreeLeech Settings Tab -->
<div class="tab-pane fade" id="freeleech-settings">
  <form method="POST" action="" id="freeleech-settings-form">
    <div class="card mb-4">
      <div class="card-header">
        <h5><i class="fas fa-gift me-2"></i> FreeLeech Settings</h5>
      </div>
      <div class="card-body">

        <!-- Тип системы -->
        <div class="mb-3">
          <label for="system" class="form-label">Select System Type</label>
          <select class="form-select" name="configoption[system]" id="system">
            <option value="freeleech" <?= $__FLSTYPE == 'freeleech' ? 'selected' : '' ?>>Free Leech</option>
            <option value="silverleech" <?= $__FLSTYPE == 'silverleech' ? 'selected' : '' ?>>Silver Leech</option>
            <option value="doubleupload" <?= $__FLSTYPE == 'doubleupload' ? 'selected' : '' ?>>Double Upload</option>
          </select>
        </div>

        <!-- Begin Date -->
        <div class="mb-3">
          <label for="start" class="form-label">Begin Date</label>
          <div class="input-group date" id="startPicker" data-target-input="nearest">
            <input type="text" 
                   class="form-control datetimepicker-input"
                   name="configoption[start]"
                   value="<?= $__F_START != '0000-00-00 00:00:00' ? $__F_START : '' ?>"
                   data-target="#startPicker"/>
            <div class="input-group-append" data-target="#startPicker" data-toggle="datetimepicker">
              <span class="input-group-text"><i class="fas fa-calendar"></i></span>
            </div>
          </div>
        </div>

        <!-- End Date -->
        <div class="mb-3">
          <label for="end" class="form-label">End Date</label>
          <div class="input-group date" id="endPicker" data-target-input="nearest">
            <input type="text" 
                   class="form-control datetimepicker-input"
                   name="configoption[end]"
                   value="<?= $__F_END != '0000-00-00 00:00:00' ? $__F_END : '' ?>"
                   data-target="#endPicker"/>
            <div class="input-group-append" data-target="#endPicker" data-toggle="datetimepicker">
              <span class="input-group-text"><i class="fas fa-calendar"></i></span>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-end mt-4">
          <button type="submit" name="save_freeleech" class="btn btn-primary px-4">
            <i class="fas fa-save me-2"></i> Save Changes
          </button>
        </div>

      </div>
    </div>
  </form>
</div>

<!-- Подключение зависимостей -->
<link rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.39.0/css/tempusdominus-bootstrap-4.min.css"/>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.39.0/js/tempusdominus-bootstrap-4.min.js"></script>

<script>
$(function () {
  moment.locale('ru');

  $('#startPicker').datetimepicker({
    format: 'YYYY-MM-DD HH:mm:ss',
    icons: { time: 'far fa-clock', date: 'far fa-calendar' }
  });

  $('#endPicker').datetimepicker({
    format: 'YYYY-MM-DD HH:mm:ss',
    icons: { time: 'far fa-clock', date: 'far fa-calendar' }
  });
});
</script>


















                    
					
		


 <?

$act = isset($_GET['act']) ? $_GET['act'] : '';
$cronid = isset($_GET['cronid']) ? (int)$_GET['cronid'] : 0;

if ((in_array($act, ['edit', 'save', 'run', 'active', 'disable', 'delete']) && is_valid_id($cronid)) || $act === 'save_new') {
    if (in_array($act, ['save', 'save_new']) && $_SERVER['REQUEST_METHOD'] === 'POST') {
        $filename = isset($_POST['filename']) ? $db->sqlesc(trim($_POST['filename'])) : "''";
        $description = isset($_POST['description']) ? $db->sqlesc(trim($_POST['description'])) : "''";

        //$minutes = (int)$_POST['minutes'] + ((int)$_POST['hours'] * 60) + ((int)$_POST['days'] * 1440) + ((int)$_POST['weeks'] * 10080) + ((int)$_POST['months'] * 43800);
		
		$mosecs = 31 * 24 * 60 * 60;
        $wsecs = 7 * 24 * 60 * 60;
        $dsecs = 24 * 60 * 60;
        $hsecs = 60 * 60;
        $msecs = 60;
        $minutes = 0;
        if (0 < $_POST['months'])
        {
          $minutes += $mosecs * $_POST['months'];
        }

        if (0 < $_POST['weeks'])
        {
          $minutes += $wsecs * $_POST['weeks'];
        }

        if (0 < $_POST['days'])
        {
          $minutes += $dsecs * $_POST['days'];
        }

        if (0 < $_POST['hours'])
        {
          $minutes += $hsecs * $_POST['hours'];
        }

        if (0 < $_POST['minutes'])
        {
          $minutes += $msecs * $_POST['minutes'];
        }
		
		
		
		
		
		
        $active = isset($_POST['active']) ? 1 : 0;
        $loglevel = isset($_POST['loglevel']) ? 1 : 0;

        if ($act === 'save_new') {
            $nextrun = TIMENOW + ($minutes * 60);
            $db->sql_query("INSERT INTO ts_cron (filename, description, minutes, nextrun, active, loglevel) VALUES ($filename, $description, '$minutes', '$nextrun', '$active', '$loglevel')");
            $success = "New cron job created successfully!";
        } else {
            $db->sql_query("UPDATE ts_cron SET filename = $filename, description = $description, minutes = '$minutes', active = '$active', loglevel = '$loglevel' WHERE cronid = '$cronid'");
            $success = "Cron job updated successfully!";
        }

        if ($db->affected_rows() > 0) {
            echo "<div class='alert alert-success'>$success</div>";
        }
    }

    if ($act === 'run') {
        $db->sql_query("UPDATE ts_cron SET nextrun = '" . TIMENOW . "' WHERE cronid = '$cronid'");
        echo "<div class='alert alert-info'>Cron job scheduled to run immediately!</div>";
    }

    if (in_array($act, ['active', 'disable'])) {
        $status = ($act === 'active') ? 1 : 0;
        $db->sql_query("UPDATE ts_cron SET active = '$status' WHERE cronid = '$cronid'");
        echo "<div class='alert alert-success'>Cron job " . ($status ? 'enabled' : 'disabled') . " successfully!</div>";
    }

    if ($act === 'delete') {
        $db->sql_query("DELETE FROM ts_cron WHERE cronid = '$cronid'");
        if ($db->affected_rows() > 0) {
            echo "<div class='alert alert-success'>Cron job deleted successfully!</div>";
        }
    }

    if (!headers_sent() && in_array($act, ['save', 'save_new', 'run', 'active', 'disable', 'delete'])) {
        header("Location: settings.php#cron-settings");
        exit();
    }
}
?>

<!-- Cron Jobs Settings Tab -->
<div class="tab-pane fade" id="cron-settings">
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Cron Jobs Management</h5>
      <a href="settings.php?act=save_new&cronid=999#cron-settings" class="btn btn-sm btn-primary">
        <i class="fas fa-plus me-1"></i> Create New Cronjob
      </a>
    </div>
    <div class="card-body">
      <?php
      if (in_array($act, ['edit', 'save_new']) && ($act === 'save_new' || is_valid_id($cronid))) {
          $IsNew = ($act === 'save_new');

          if (!$IsNew) {
              $query = $db->sql_query("SELECT * FROM ts_cron WHERE cronid = '$cronid'");
              if ($db->num_rows($query)) {
                  $Cron = $db->fetch_array($query);
                  $TArray = calc_cron_time($Cron['minutes']);
              } else {
                  echo '<div class="alert alert-danger">Cron job not found!</div>';
                  $IsNew = true;
              }
          }

          if ($IsNew) {
              $Cron = ['cronid' => 999, 'filename' => '', 'description' => '', 'active' => 0, 'loglevel' => 0];
              $TArray = [];
          }

          ?>
          <form method="POST" action="settings.php?act=save&cronid=<?php echo $Cron['cronid']; ?>#cron-settings">
            <input type="hidden" name="save_new" value="<?php echo $IsNew ? 'true' : ''; ?>">

            <div class="mb-3">
              <label for="filename" class="form-label">Filename</label>
              <input type="text" class="form-control" name="filename" id="filename" value="<?php echo htmlspecialchars($Cron['filename']); ?>" required>
            </div>

            <div class="mb-3">
              <label for="description" class="form-label">Description</label>
              <input type="text" class="form-control" name="description" id="description" value="<?php echo htmlspecialchars($Cron['description']); ?>" required>
            </div>

            <div class="row g-2">
              <?php
              $timeFields = [
                'months' => 12,
                'weeks' => 4,
                'days' => 31,
                'hours' => 24,
                'minutes' => 60,
              ];
              foreach ($timeFields as $name => $max) {
                  echo "<div class='col-md'><label class='form-label text-capitalize'>$name</label><select class='form-select' name='$name'>";
                  for ($i = 0; $i <= $max; $i++) {
                      $selected = (isset($TArray[$name]) && $TArray[$name] == $i) ? 'selected' : '';
                      echo "<option value='$i' $selected>$i $name</option>";
                  }
                  echo "</select></div>";
              }
              ?>
            </div>

            <div class="form-check form-switch mt-3">
              <input class="form-check-input" type="checkbox" id="active" name="active" value="1" <?php echo $Cron['active'] ? 'checked' : ''; ?>>
              <label class="form-check-label" for="active">Activate</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="loglevel" name="loglevel" value="1" <?php echo $Cron['loglevel'] ? 'checked' : ''; ?>>
              <label class="form-check-label" for="loglevel">Log cron execution</label>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-1"></i> Save
              </button>
              <a href="settings.php#cron-settings" class="btn btn-secondary">
                <i class="fas fa-times me-1"></i> Cancel
              </a>
            </div>
          </form>
      <?php } ?>

      <!-- Cron Job Table -->
      <div class="table-responsive mt-4">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Filename</th>
              <th>Description</th>
              <th>Run Period</th>
              <th>Next Run</th>
              <th>Logging</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
          <?php
          $result = $db->sql_query("SELECT * FROM ts_cron ORDER BY cronid");
          while ($cron = $db->fetch_array($result)) 
		  {
              echo "<tr>
                <td>" . htmlspecialchars($cron['filename']) . "</td>
                <td>" . htmlspecialchars($cron['description']) . "</td>
                <td>" . mkprettytime($cron['minutes']) . "</td>
                <td>" . my_datee ($dateformat, $cron['nextrun']) . ' ' . my_datee ($timeformat, $cron['nextrun']) . "</td>
                <td><span class='badge bg-" . ($cron['loglevel'] ? 'success' : 'danger') . "'>" . ($cron['loglevel'] ? 'YES' : 'NO') . "</span></td>
                <td><span class='badge bg-" . ($cron['active'] ? 'success' : 'danger') . "'>" . ($cron['active'] ? 'ACTIVE' : 'DISABLED') . "</span></td>
                <td>
                  <div class='btn-group btn-group-sm'>
                    <a href='?act=run&cronid={$cron['cronid']}#cron-settings' class='btn btn-outline-primary'><i class='fas fa-play'></i></a>
                    <a href='?act=edit&cronid={$cron['cronid']}#cron-settings' class='btn btn-outline-secondary'><i class='fas fa-edit'></i></a>
                    <a href='?act=" . ($cron['active'] ? 'disable' : 'active') . "&cronid={$cron['cronid']}#cron-settings' class='btn btn-outline-" . ($cron['active'] ? 'warning' : 'success') . "'><i class='fas fa-power-off'></i></a>
                    <a href='settings.php?act=delete&cronid={$cron['cronid']}#cron-settings' 
                       class='btn btn-outline-danger' title='Удалить' 
                       onclick=\"return confirm('Are, you sure to want delete?');\">
                      <i class='fas fa-trash-alt'></i>
                    </a>
                  </div> 		  
                </td>
              </tr>";
          }
          ?>
		  
          </tbody>
        </table>
      </div>
    </div>
  </div>



  <!-- Cron Jobs Execution Logs Section -->
  <div class="card mt-4">
    <div class="card-header">
      <h6 class="mb-0">Cron Jobs Execution Logs</h6>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-sm table-striped">
          <thead>
            <tr>
              <th>Filename</th>
              <th class="text-center">Query Count</th>
              <th class="text-center">Execute Time</th>
              <th class="text-center">Last Run</th>
            </tr>
          </thead>
          <tbody>
            <?php
            $query = $db->sql_query('SELECT * FROM ts_cron_log ORDER BY runtime DESC LIMIT 50');
            while ($log = $db->fetch_array($query)) :
            ?>
              <tr>
                <td><?php echo htmlspecialchars($log['filename']); ?></td>
                <td class="text-center"><?php echo number_format($log['querycount']); ?></td>
                <td class="text-center"><?php echo $log['executetime']; ?> sec</td>
                <td class="text-center">
                  <?php echo date($dateformat, $log['runtime']) . ' ' . date($timeformat, $log['runtime']); ?>
                </td>
              </tr>
            <?php endwhile; ?>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Tab Activation Script -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const hash = window.location.hash;
  if (hash && document.querySelector('a[data-bs-toggle="tab"][href="' + hash + '"]')) {
    new bootstrap.Tab(document.querySelector('a[data-bs-toggle="tab"][href="' + hash + '"]')).show();
  }
});
</script>


				
					
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
   
    <script>
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('.help-icon'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>
</body>
</html>

<?
stdfoot();